<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>卫生政策与管理实证研究手册 - 5&nbsp; 因果推断方法</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter_6.html" rel="next">
<link href="./chapter_4.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">因果推断方法</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">卫生政策与管理实证研究手册</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">前言</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">文献知识的获取与管理</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">数据库操作</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">数据的清洗</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">数据的描述</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_5.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">因果推断方法</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">番外篇（一）：随机化分组</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">番外篇（二）：匹配</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_8.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">番外篇（三）：主成分分析</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_references.html" class="sidebar-item-text sidebar-link">参考文献</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#引子" id="toc-引子" class="nav-link active" data-scroll-target="#引子"><span class="toc-section-number">5.1</span>  引子</a></li>
  <li><a href="#双重差分" id="toc-双重差分" class="nav-link" data-scroll-target="#双重差分"><span class="toc-section-number">5.2</span>  双重差分</a>
  <ul class="collapse">
  <li><a href="#简介" id="toc-简介" class="nav-link" data-scroll-target="#简介"><span class="toc-section-number">5.2.1</span>  简介</a></li>
  <li><a href="#基本型" id="toc-基本型" class="nav-link" data-scroll-target="#基本型"><span class="toc-section-number">5.2.2</span>  基本型</a></li>
  <li><a href="#变化" id="toc-变化" class="nav-link" data-scroll-target="#变化"><span class="toc-section-number">5.2.3</span>  变化</a></li>
  </ul></li>
  <li><a href="#diff-in-diff的适用场景" id="toc-diff-in-diff的适用场景" class="nav-link" data-scroll-target="#diff-in-diff的适用场景"><span class="toc-section-number">5.3</span>  1. Diff-in-Diff的适用场景</a>
  <ul class="collapse">
  <li><a href="#为什么要用双重差分" id="toc-为什么要用双重差分" class="nav-link" data-scroll-target="#为什么要用双重差分"><span class="toc-section-number">5.3.1</span>  1.1 为什么要用双重差分</a></li>
  <li><a href="#什么时候可以用双重差分" id="toc-什么时候可以用双重差分" class="nav-link" data-scroll-target="#什么时候可以用双重差分"><span class="toc-section-number">5.3.2</span>  1.2 什么时候可以用双重差分</a></li>
  <li><a href="#双重差分的基本原理" id="toc-双重差分的基本原理" class="nav-link" data-scroll-target="#双重差分的基本原理"><span class="toc-section-number">5.3.3</span>  1.3 双重差分的基本原理</a></li>
  </ul></li>
  <li><a href="#diff-in-dff的模型设定" id="toc-diff-in-dff的模型设定" class="nav-link" data-scroll-target="#diff-in-dff的模型设定"><span class="toc-section-number">5.4</span>  2. Diff-in-Dff的模型设定</a></li>
  <li><a href="#diff-in-dff的变化" id="toc-diff-in-dff的变化" class="nav-link" data-scroll-target="#diff-in-dff的变化"><span class="toc-section-number">5.5</span>  3. Diff-in-Dff的变化</a>
  <ul class="collapse">
  <li><a href="#变化型一matching-did" id="toc-变化型一matching-did" class="nav-link" data-scroll-target="#变化型一matching-did"><span class="toc-section-number">5.5.1</span>  变化型一：Matching-DID</a></li>
  <li><a href="#变化型二非同一时点干预" id="toc-变化型二非同一时点干预" class="nav-link" data-scroll-target="#变化型二非同一时点干预"><span class="toc-section-number">5.5.2</span>  变化型二：非同一时点干预</a></li>
  <li><a href="#变化型三事件分析法" id="toc-变化型三事件分析法" class="nav-link" data-scroll-target="#变化型三事件分析法"><span class="toc-section-number">5.5.3</span>  变化型三：事件分析法</a></li>
  <li><a href="#变化型四scm-did" id="toc-变化型四scm-did" class="nav-link" data-scroll-target="#变化型四scm-did"><span class="toc-section-number">5.5.4</span>  变化型四：SCM-DID</a></li>
  </ul></li>
  <li><a href="#工具变量" id="toc-工具变量" class="nav-link" data-scroll-target="#工具变量"><span class="toc-section-number">5.6</span>  工具变量</a></li>
  <li><a href="#断点回归" id="toc-断点回归" class="nav-link" data-scroll-target="#断点回归"><span class="toc-section-number">5.7</span>  断点回归</a>
  <ul class="collapse">
  <li><a href="#简介-1" id="toc-简介-1" class="nav-link" data-scroll-target="#简介-1"><span class="toc-section-number">5.7.1</span>  简介</a></li>
  <li><a href="#发展历史" id="toc-发展历史" class="nav-link" data-scroll-target="#发展历史"><span class="toc-section-number">5.7.2</span>  发展历史</a></li>
  <li><a href="#特点与分类" id="toc-特点与分类" class="nav-link" data-scroll-target="#特点与分类"><span class="toc-section-number">5.7.3</span>  特点与分类</a></li>
  <li><a href="#适用rd分析的先决条件conditions-for-internal-validity" id="toc-适用rd分析的先决条件conditions-for-internal-validity" class="nav-link" data-scroll-target="#适用rd分析的先决条件conditions-for-internal-validity"><span class="toc-section-number">5.7.4</span>  适用RD分析的先决条件(Conditions for Internal Validity)</a></li>
  <li><a href="#断点回归的图形分析graphical-presentations-in-the-rd" id="toc-断点回归的图形分析graphical-presentations-in-the-rd" class="nav-link" data-scroll-target="#断点回归的图形分析graphical-presentations-in-the-rd"><span class="toc-section-number">5.7.5</span>  断点回归的图形分析(Graphical Presentations in the RD)</a></li>
  <li><a href="#进行rd分析的步骤及示例" id="toc-进行rd分析的步骤及示例" class="nav-link" data-scroll-target="#进行rd分析的步骤及示例"><span class="toc-section-number">5.7.6</span>  进行RD分析的步骤及示例</a></li>
  <li><a href="#关于fuzzy类型的rd模型估计方法" id="toc-关于fuzzy类型的rd模型估计方法" class="nav-link" data-scroll-target="#关于fuzzy类型的rd模型估计方法"><span class="toc-section-number">5.7.7</span>  关于Fuzzy类型的RD模型估计方法</a></li>
  <li><a href="#结束" id="toc-结束" class="nav-link" data-scroll-target="#结束"><span class="toc-section-number">5.7.8</span>  结束</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">因果推断方法</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="引子" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="引子"><span class="header-section-number">5.1</span> 引子</h2>
<p>  最近几年随着微信公众号和知乎等迅速成为各类信息传播的主要平台，国内科研工作者慢慢的很少”逛”论坛、发帖子、写博客了，有的转战公众号开设自己的账号，有的开始团队运营，这些平台给科学研究提供了不少便利性，扩大了知识获取面，降低了知识检索的时间成本。但是其弊端也毕竟明显，一方面是导致很多人对前沿科学咨讯的获取基本来源于公众号，很少阅读原始文献，另一方面是公众号或者知乎平台分享的信息和知识点没有经过同行评议，其实不乏有错误之处，若不加思索的参考或者照搬很容易导致研究方法误用，特别是对于尚处于学术生涯初期的研究生。</p>
<p>  关于介绍因果推断方法的书籍非常多了，包括Angrist &amp; JoshuaDavid著的《Mostly Harmless Econometrics: An Empiricist Companion》，Wooldridge的《计量经济学导论》等等。本书并不打算再次搬运以上这些著作的内容，而是主要记录一个学习者在学习和使用这些方法过程中的心路历程，分享学习和使用这些方法的一些经验和体会。</p>
<p><strong>本书的主要参考资料如下：</strong></p>
<blockquote class="blockquote">
<ol type="1">
<li>Angrist, &amp; JoshuaDavid. (2010). Mostly Harmless Econometrics: An Empiricist Companion. Princeton University Press.</li>
<li>伍德里奇, &amp; 费剑平校. (2010). 计量经济学导论: 第4版. 中国人民大学出版社.</li>
<li>Scott Cunningham. (2020). Causal Inference: The Mixtape. Yale University Press.</li>
<li><a href="https://lost-stats.github.io/Model_Estimation/Research_Design/event_study.html" class="uri">https://lost-stats.github.io/Model_Estimation/Research_Design/event_study.html</a></li>
</ol>
</blockquote>
</section>
<section id="双重差分" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="双重差分"><span class="header-section-number">5.2</span> 双重差分</h2>
<section id="简介" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="简介"><span class="header-section-number">5.2.1</span> 简介</h3>
<p>  双重差分法（Difference-in-Difference，DID）通常又可称作倍差法或差异中的差异法，是目前社会科学领域用于开展政策效果评估和识别两个因素因果关联的的最常用方法之一。DID最早由Orley Ashenfelter和David Card提出 ，两位学者于1985年在学术期刊《Review of Economics and Statistics》上发表了运用DID的方法估计美国综合就业和培训法案对收入的影响 <span class="citation" data-cites="ashenfelter1985">Ashenfelter and Card (<a href="chapter_references.html#ref-ashenfelter1985" role="doc-biblioref">1985</a>)</span> 。DID本质是一种准实验设计（quasi-experimental design），利用干预组和对照组的纵向数据来获得适当的反事实（counterfactual）来估计因果效应，方法是比较参加项目的人群（干预组）和未参加的人群（对照组）之间的结果随时间的变化，其通常用于估计特定的干预或治疗（如某项法律的通过、某种政策的实施或大规模项目实行）的效果。</p>
<p>  DID的基本原理很简单，但是如果据此就认为采用DID识别框架的方法都很简单就错了，随着Joshua D. Angrist、Guido W. Imbens、Gary King、Susan Athey等经济学和统计学家对因果识别方法体系的贡献，时至今日，DID已经衍生出了多种多样的类型来使用不同的研究设计和数据结构，可以说已经是一大方法家族了吧。</p>
<p>  DID的统计学基础是哈佛大学著名统计学家 <span class="citation" data-cites="rubin1980">(<a href="chapter_references.html#ref-rubin1980" role="doc-biblioref">Rubin 1980</a>)</span> 提出的潜在结果模型（potential outcomes model）或称为反事实框架 (counterfactual framework)，其核心思想在于利用“反事实”假设构造一个可比的对照组来消除样本选择偏误（selection bias）。根据潜在结果模型可知，要想获得某种干预的因果效应就必须比较同一个研究对象在接受干预和不接受干预时结果差异，此时这种差异才是接受干预相对于不接受干预的效果。然而，对于同一研究对象而言，通常无法既观察其接受干预的结果，又观察其不接受干预的结果。对于接受干预的研究对象而言，不接受干预时的状态是一种 “反事实” 状态，对于不接受干预的研究对象而言，接受干预时的状态也是一种 “反事实” 状态，正是由于在同一研究对象中同一时点接受干预与非干预的状态存在互斥性，因此无法通过直接观察“反事实”状态下的效应值。</p>
<p>  在医学研究中，为了解决这个问题通常采用随机对照试验（RCT）的方法，通过随机化的方法将一组具有高度同质性的研究对象随机分配去接受干预（trentment group）或不接受干预（control group），由于研究对象具有高度同质性且通过随机化消除了样本选择偏误，那么就可以在限定条件下认为，未接受干预的那部分研究对象（control group）就是接受了干预的研究对象（trentment group）在未接受干预时（untreated）的状态。但是，在政策研究中，通常无法人为对政策的执行施加影响，无法做到随机化，干预组和对照组的研究对象很难保证具有高度同质性，尽管如此，计量经济学家们探索出了利用干预组与对照组之间可能存在不随时间变化的系统性差异的特点，构造出了消除样本选择偏误而得到相对纯净政策效应的计量方法，其中就以DID为代表。</p>
</section>
<section id="基本型" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="基本型"><span class="header-section-number">5.2.2</span> 基本型</h3>
</section>
<section id="变化" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="变化"><span class="header-section-number">5.2.3</span> 变化</h3>
</section>
</section>
<section id="diff-in-diff的适用场景" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="diff-in-diff的适用场景"><span class="header-section-number">5.3</span> 1. Diff-in-Diff的适用场景</h2>
<section id="为什么要用双重差分" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="为什么要用双重差分"><span class="header-section-number">5.3.1</span> 1.1 为什么要用双重差分</h3>
<p>最简单的一句话就是因果识别是各个学科关注的核心问题之一，但是社会科学领域很难开展实验研究，所以需要从分析手段上想办法找到估计干预效应更准的方法。这就是为什么流行病与卫生统计学科的人不怎么热衷双重差分的原因，因为他们更关注RCT，在研究设计上就解决了随机分组的问题，直接student t或者anova就能估计出净的干预效应，通常称为average treatment effect on treated (ATT)。</p>
</section>
<section id="什么时候可以用双重差分" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="什么时候可以用双重差分"><span class="header-section-number">5.3.2</span> 1.2 什么时候可以用双重差分</h3>
<p>简单来说就是需要进行因果识别研究的时候，具体而言通常就是政策评估时常用，因为政策评估通常为社会自然实验，无法进行随机分组和随机抽样，因此无法采用随机对照试验的方法，政策评估有四种常用方法：</p>
<ul>
<li><strong>工具变量法</strong>：寻找外生的工具变量，通过两阶段ols估计，分离出扰动项中与内生变量相关的变异，从而获得更干净的内生解释变量的效应值。具体而言就是，第一阶段用内生解释变量作为被解释变量（因变量），将工具变量作为解释变量（自变量），进行ols估计，获得内生解释变量的预测值；第二阶段则是将内生解释变量的预测值作为解释变量（自变量），将研究原本的指标作为被解释变量再进行ols估计，则内生解释变量的估计参数即为净效应值。<em>缺点</em>：工具变量难找</li>
<li><strong>断点回归</strong>：本质就是趋近局部的随机对照试验，具体介绍可见这篇<a href="https://shumchi.github.io/Step-by-Step-to-do-a-Regression-Discontinuity-analysis/">帖子</a>。</li>
<li><strong>双重差分</strong>：通过进行两次差分获得ATT</li>
<li><strong>倾向得分匹配</strong>：适用于横断面研究</li>
</ul>
<p><strong>双重差分分析对数据的要求，也就是什么情况下可以考虑双重差分：</strong></p>
<ul>
<li><p>两个时间点的个体横断面数据（微观数据）：</p>
<p>两个横断面个体不是同一批人，也就是常说的两个混合截面，很多较为早期开展的survey数据是这种形式。只要能找到一个变量，能够在第一个横断面中识别出与第二个横断面中受到干预的个体相对应的个体即可，也就需要找到第一个横断面中哪些个体属于干预组。通常可以通过<code>地区</code>变量来分辨，对于试点政策多采取这种方法，因为追踪调查比较费时费力。<strong>缺点：无法避免两次横断面调查带来的抽样误差，因为两个横断面的个体并不是同一批人，虽然抽样误差会在组间diff的时候被减去，但这种情况需要抽样误差在对照和干预个体中是均匀分布的</strong>。</p></li>
<li><p>两期及更多期的追踪数据，本质就是面板数据：</p>
<p>和上面情况一样，都是survey数据，但是为追踪调查，也就是每个时间点调查的个体都是同一批人。这种数据最优，可以进行的差分方法变化也最多，但是较难获得，好在最近些年开展的大规模人群调查都在采取追踪调查的方式。</p></li>
<li><p>两期及更多期的机构或地区数据，就是常见的机构或地区面板数据（宏观数据）：</p>
<p>比第二种情况更容易获得数据，但是缺点在于很难收集到样本量足够大、分析单元足够小的数据，比如较为容易获得的省级面板数据实际缺点较大。</p></li>
<li><p>单一的横断面数据：严格来讲是无法进行双重差分设计的，但是也有采用横断面进行差分研究的实例，比如研究中国大饥荒的通过不同出生队列构建的差分模型。</p></li>
</ul>
</section>
<section id="双重差分的基本原理" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="双重差分的基本原理"><span class="header-section-number">5.3.3</span> 1.3 双重差分的基本原理</h3>
<p>为什么通过两次差分就能估计出净效应的原理不详述，这里只讨论一个问题：为什么RCT的研究在估计干预效应时只diff一次，而这里要diff两次？</p>
<p>这就涉及到了双重差分方法的一个最重要的前提假设：<strong>共同趋势（Common Trends）假设，即干预组和对照组在政策实施之前必须具有相同的发展趋势</strong>。</p>
<p><strong>那么为什么要有这个假设呢，可以看下面的示意图：</strong></p>
<p>左边的图就是最常见的双重差分原理的示意图，共同趋势假设的目的就是为了保证基线期（before）的diff，如果没有treatment，干预组和对照组之间的差异仍然是这个diff，所以在第二次差分时扣掉这个diff就能得到净干预效应。</p>
<p>所以这个共同趋势假设是为了保证干预和对照组在干预前后基础的变化都是一致的，它包含两层意思：一是必须趋势不变，也就是都是上升或下降或不变；二是必须平行。因此这个共同趋势假设只是一个基础，是在这个假设成立的基础上，才能推断在干预后，干预组和对照组也会（<em>是也会，不是一定，所以这就是双重差分并不完美的地方</em>）按照这个趋势变化，才能利用第二次差分。而有的公众号中写的是只要共同趋势满足，就可以大胆使用双重差分，其实并不是。</p>
<p>上面只说了共同趋势假设是为了保证反事实情况下的变化一致，但是并没有说出有这个假设的原因。应该也有人会问，为什么所有的双重差分的示意图在干预前的两条线都是平行的，<strong>但是有间隙</strong>。<strong>原因就是前面所讲的，这种自然试验无法保证干预组和对照组是随机分配的，换句话说就是这两组人在没有施加干预时，就是两个人群，所以会有差异，也就是示意的间隙</strong>。</p>
<p>因为这个“间隙”（就是组间差异）比较大，所以就需要在干预后把它扣除掉，如果不扣除直接对干预后的两组进行差值比较，那么这个差值中时包含了这个“间隙”的，如果这个“间隙”比真实干预效应还大，那么得到的两组差值就失去意义了，所以才会有第二次diff（第一次diff两组分别是前后减，第二次diff是在第一次的结果上干预和对照减）。</p>
<p>那么，如果这个“间隙”足够小呢，小到随机误差那么大，是不是就可以不用减的。那这就是为什么RCT只diff一次的原因，因为在试验设计阶段，通过严格的随机化已经保证的干预组和对照组个体的一致性，也就是已经将这个“间隙”降到足够小了，就像右边的图示意的一样。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/shumchi/shumchi.github.io/blob/master/_posts/2020-01-17-M4%20Quarter/Diagram.png?raw=true" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">letter</figcaption><p></p>
</figure>
</div>
</section>
</section>
<section id="diff-in-dff的模型设定" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="diff-in-dff的模型设定"><span class="header-section-number">5.4</span> 2. Diff-in-Dff的模型设定</h2>
<p>双重差分的基准模型如下：</p>
<p><span class="math display">\[ y_{it} = \beta_1 \cdot Treat*Time + \beta_2 Treat + \beta_3 Time + \beta_0+ \epsilon_{it} \]</span></p>
<p>各参数代表意义就不解释了，其采用ols估计就行了，该模型适用于前面所提到的第一种和第二种中的两期的数据类型。</p>
<p>但是，如果仔细看的话，该模型就是采用的双向固定效应模型，其中treat是个体效应，time是时间效应。因此，对于多期的面板数据，你又会看见下面的模型：</p>
<p><span class="math display">\[
y_{it} = \beta \cdot Treat*Time + \lambda t + \mu_i + \epsilon_{it}
\]</span></p>
<p>其中没有了treat和time，取而代之是lambda和mu代表的个体效应和时间效应，因为在多期面板中，如果仍然用treat和time会过于粗糙，time只有0和1，无法识别出完整的时间效应，而treat同样存在这个问题。</p>
<p>当然模型还有其他变化，比如当treat为连续变量时，政策冲击不是在同一时间单一完成的，但是归根结底都是双向固定效应模型的变换形式。</p>
</section>
<section id="diff-in-dff的变化" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="diff-in-dff的变化"><span class="header-section-number">5.5</span> 3. Diff-in-Dff的变化</h2>
<p>正如前面所将，双重差分法并不要求干预组和对照组是完全一致的，可以存在一定的差异，但是要求这种差异不随着时间产生变化，这也是在共同趋势假设成立的基础上，能够进一步推断干预后这个差异仍然是基线的差异的基础，因为前面几年是平行变化的，并不代表在政策施加之后也是平行变化的。但是这个不随时间变化的要求是无法检验的，所以这就成了双重差分法的一个无法避免的weakness。</p>
<p><strong>那么，有人会问如果共同趋势不满足怎么办，当然会有其他的方法：匹配+双重差分，最常见的是psm+did，当然也可以是cem+did</strong></p>
<p>对于两期的混合截面或者面板数据而言，是无法进行共同趋势检验的，所以有的论文中在这种情况下就不提共同趋势的事，对于多期面板虽然可以检验共同趋势，但是也会存在这个假设不满足的情况。</p>
<p>所以，为了研究的严谨性和可继续下去，有的学者就提出提出对样本进行匹配，因为共同趋势不满足的根本原因就是干预组和对照组之间差异太大，所以就通过匹配的办法让两组个体更加可比一些，将“间隙”缩小一些。</p>
<p>那么有的人又会问，既然前面说的横断面数据可以用匹配的方法进行效应估计，那既然都匹配了，也就是说趋近随机分组了，那么为什么还要diff两次。解释就是想要真正做到随机分组，匹配的变量需要很多，匹配的效果与RCT还是有差别，两组间的“间隙”仍然存在，所以还是需要用双重差分估计更干净的效应。</p>
<p>这里需要注意的一点是，应用匹配+双重差分的方法，不同的数据情况采用不同的匹配策略。</p>
<ul>
<li>因为对于面板数据，得到了干预前匹配后的个体，自然就确定了干预后的个体。</li>
<li>而对于两个时点的混合截面数据，由于干预前后的个体本来就不是精确对应的，所以如果要用匹配+did的话，就需要进行三次匹配：干预前：干预 vs 对照，获得干预前匹配好的样本，然后在这个基础上，在第二期截面数据里，分别在干预组和对照组中进行 干预前 vs 干预后的匹配，这样才能严格满足要求，但是缺点是会损失较大的样本量。</li>
<li>当然，对于两个时点的混合截面数据，也可以只进行两次匹配，第一个时点：干预 vs 对照，第二个时间点：干预 vs 对照，这样做的一个前提是，要有足够的证据支持两个时点的样本都是总体的随机样本，也就是抽样误差要足够小。</li>
<li>对于psm或cem阶段，如果采取的是1:1匹配，那么在后续did回归时不需要考虑匹配权重的问题，如果采取的不是1:1匹配，则需要在回归时进行加权回归（对干预前个体匹配获得的权重，应该也要赋给干预后的）。</li>
</ul>
<section id="变化型一matching-did" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="变化型一matching-did"><span class="header-section-number">5.5.1</span> 变化型一：Matching-DID</h3>
</section>
<section id="变化型二非同一时点干预" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="变化型二非同一时点干预"><span class="header-section-number">5.5.2</span> 变化型二：非同一时点干预</h3>
</section>
<section id="变化型三事件分析法" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="变化型三事件分析法"><span class="header-section-number">5.5.3</span> 变化型三：事件分析法</h3>
</section>
<section id="变化型四scm-did" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4" class="anchored" data-anchor-id="变化型四scm-did"><span class="header-section-number">5.5.4</span> 变化型四：SCM-DID</h3>
</section>
</section>
<section id="工具变量" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="工具变量"><span class="header-section-number">5.6</span> 工具变量</h2>
</section>
<section id="断点回归" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="断点回归"><span class="header-section-number">5.7</span> 断点回归</h2>
<section id="简介-1" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1" class="anchored" data-anchor-id="简介-1"><span class="header-section-number">5.7.1</span> 简介</h3>
<p>  断点回归（Regression Discontinuity）适用于以下情形：人群是否接受干预（Treatment）是依据某一数值变量（rating variable）是否高于或低于某一确定的阈值（threshold）或者分割点（cut-point），例如在研究是否上大学会影响收入时，数值变量（rating variable，也叫 assignment variable，score，running variable，forcing variable， or index）就是高考分数，阈值或者分割点就是本科录取分数线。以下内容主要参考：<span class="citation" data-cites="Sebastian2022 matias2017 jacob2012 xie2019">(<a href="chapter_references.html#ref-Sebastian2022" role="doc-biblioref">Calonico et al. 2022</a>; <a href="chapter_references.html#ref-matias2017" role="doc-biblioref">D. Cattaneo, Idroboy, and Titiunik 2017</a>; <a href="chapter_references.html#ref-jacob2012" role="doc-biblioref">Jacob, Zhu, and Marie-Andrée 2012</a>; <a href="chapter_references.html#ref-xie2019" role="doc-biblioref">谢谦, 薛仙玲, and 付明卫 2019</a>)</span>。</p>
</section>
<section id="发展历史" class="level3" data-number="5.7.2">
<h3 data-number="5.7.2" class="anchored" data-anchor-id="发展历史"><span class="header-section-number">5.7.2</span> 发展历史</h3>
<p>  Regression Discontinuity最早由社会学家Thistlethwaite and Campbell 在1960年提出的，用于评估社会项目，但是他们的研究虽然引起一些影响但是没有得到广泛的注意，后来，在1972-2009年期间，被一系列经济学家(Goldberger，van der Klaauw，Imbens and Kalyanaraman等)在方法学方面进行了完善，最终在2008年达到顶峰，标志是在2008年Journal of Econometrics出了一期RD分析的<a href="https://www.sciencedirect.com/journal/journal-of-econometrics/vol/142/issue/2">Special Issue</a>，光看期刊名字就知道是经济学顶刊了(<strong>Journal of Econometrics是公认的计量经济学顶尖期刊，是教育部认可的12本经济学国际顶级期刊之一</strong> )。</p>
</section>
<section id="特点与分类" class="level3" data-number="5.7.3">
<h3 data-number="5.7.3" class="anchored" data-anchor-id="特点与分类"><span class="header-section-number">5.7.3</span> 特点与分类</h3>
<p><strong>RD有两个特点：</strong></p>
<ul>
<li>在Rating variable的一个明确点上，outcome出现了跳跃或者不连续(discontinuity at a cut-point)</li>
<li>可以认为在一个限定的rating variable区间上，个体是服从局部随机的(local randomization)</li>
</ul>
<p><strong>RD有两种类型：</strong></p>
<ul>
<li><p>精确断点(sharp design): 即所有个体(All subject)在明确的cut-point之后全部接受干预(treatment)</p></li>
<li><p>模糊断点(fuzzy design): 即在cut-point前后，存在 no-shows (treatment group members who do not receive the treatment)或者crossovers (control group members who do receive the treatment) ，换句话说就无法找到一个明确的cut-point完全区分干预和对照组。更严格的分法是，fuzzy也可以分成两类：type I是no-shows，只存在处理组有未接受处理的个体，type II是同时存在no-shows和crossovers。实际就是RCT中常说的沾染问题。</p></li>
</ul>
</section>
<section id="适用rd分析的先决条件conditions-for-internal-validity" class="level3" data-number="5.7.4">
<h3 data-number="5.7.4" class="anchored" data-anchor-id="适用rd分析的先决条件conditions-for-internal-validity"><span class="header-section-number">5.7.4</span> 适用RD分析的先决条件(Conditions for Internal Validity)</h3>
<p>  由于RD仍然属于非实验方法，尽管也被成为类实验(quasi-experimental)，但本质还是非实验方法(nonexperimental)， 所以它必须满足一系列前期条件，才能提供无偏估计和更可能的接近RCT的严格情形。</p>
<ul>
<li><p><strong>一、</strong> Rating variable (中文的翻译很多，但比较通用的翻译为驱动变量或者配置变量)不能被干预(treatment)所影响，Rating variable 的值必须是在干预(treatment)<strong>之前</strong>就已经确定了，或者是不可再更改的变量。也就是只能是驱动变量的值决定是否接受干预，不能是干预决定驱动变量的值。比如：高考成绩(Rating variable)是在判断是否能够上大学(treatment)之前就已经确定了，并且分数不会再发生变化，如果存在严重的根据分数线修改高考成绩的情况，则高考分数就不能作为Rating variable。 <strong>检验方法是：画Rating variable的频率分布直方图或者密度图，再进行McCrary 检验</strong></p></li>
<li><p><strong>二、</strong> 断点(cut-point)是完全外生的，并且干预与否完全取决于驱动变量和断点。即断点不受其他因素影响而改变干预的判断，即把本不该接受干预的对象划入了干预，或者把该接受干预的对象划入了对照。 比如，如果高考录取线(cut-point)的确定是完全已经严格的录取指标划定的， 而不存在为了使得某部分人群能够获得上大学的机会，而修改录取线。</p></li>
<li><p><strong>三、</strong> 在驱动变量的cut-point前后，除了干预与否(treatment)是不连续或者跳跃的(比如断点前为0，断点后为1)，其他任何因素都不能出现不连续或者跳跃(Nothing other than treatment status is discontinuous in the analysis interval)，因为要保证outcome的跳跃只能是干预的不连续或者跳跃导致的。比如，如果高考分数线除了决定是否能上大学外，还决定是否享有创业扶持机会，那么如果研究上大学对某种结局的影响，就无法分离出到底是大学教育导致，还是获得创业扶持机会导致的。</p></li>
<li><p><strong>四、</strong> 驱动变量(rating variable)与结局变量(outcome)之间的函数关系应该是连续的，严格的说，应该是在进行RD分析的这段区间内(interval)是连续的。换句话说就是，如果不存在干预的情况，驱动变量与结局变量之间不会出现不连续或者跳跃，才能在结局变量出现不连续的情况下，反推出是干预引起的，因为只有干预是不连续的。<strong>注意：此条件只需要在选择参数估计方法是要满足(applies only to parametric estimators)</strong></p></li>
</ul>
</section>
<section id="断点回归的图形分析graphical-presentations-in-the-rd" class="level3" data-number="5.7.5">
<h3 data-number="5.7.5" class="anchored" data-anchor-id="断点回归的图形分析graphical-presentations-in-the-rd"><span class="header-section-number">5.7.5</span> 断点回归的图形分析(Graphical Presentations in the RD)</h3>
<p><strong>图形分析是进行RD的第一步，也是非常重要的组成部分</strong></p>
<p><strong>通常，进行RD至少需要画4种图：</strong></p>
<ul>
<li>驱动变量与干预之间的关系图，在这一步可以确定是应该采取Sharp还是Fuzzy断点回归设计</li>
<li>非结局变量与驱动变量的关系图，可以用来判断是否满足第3条内部有效性(Internal Validity)条件</li>
<li>驱动变量的密度分布图，是为了判断驱动变量是否连续，以及在cut-point附近是否存在被操控，可以用来判读石佛满足第1条内部有效性(Internal Validity)条件</li>
<li>结局变量与驱动变量的关系图，可以帮助预估干预效应的大小，以及判断结局变量与驱动变量之间的函数关系。而且必须是结局变量在纵轴，驱动变量在横轴。<strong>注意：通常这一幅图是用来初步判断整个研究是否能够获得预期的干预效应的，如果在这幅图中无法观测到明显的jump，基本后续的分析也是徒劳。</strong></li>
</ul>
</section>
<section id="进行rd分析的步骤及示例" class="level3" data-number="5.7.6">
<h3 data-number="5.7.6" class="anchored" data-anchor-id="进行rd分析的步骤及示例"><span class="header-section-number">5.7.6</span> 进行RD分析的步骤及示例</h3>
<p><strong>示列软件</strong>: R version 4.0.5 (2021-03-31)<br>
<strong>示列分析包</strong>：在R语言中一共有三个package可以进行RD分析：</p>
<ul>
<li><strong>rdd</strong>: 由Dimmery在2016年发布，最后一次更新是2016-3-14，貌似目前没有获得积极的更新</li>
<li><strong>rddtools</strong>：由Stigler &amp; Quast最早在2013年发布，最后一次更新是2015-07-27，貌似目前也没有获得积极的更新</li>
<li><strong>rdrobust</strong>：由Sebastian Calonico, Matias D. Cattaneo, Max H. Farrell等在2016年发布的，最后一次更新是2018-09-26，是目前功能最完善的RD分析包，同时也开发了Stata版本。该包的作者同时也是RD方法学上的大佬，多种bandwidth选择方法的发明者，著名的CCT就是。</li>
</ul>
<blockquote class="blockquote">
<p>rdrobust简介：目前该包的开发项目可在<a href="https://sites.google.com/site/rdpackages/home" class="uri">https://sites.google.com/site/rdpackages/home</a>主页上查看，该包共有三个函数： + rdplot：用来画图 + rdrobust：用来进行局部非参数估计 + rdbwselect：用来进行bandwidth选择 另外还有一个协同的包<strong>rddensity</strong>，需要从CRAN上单独安装，用来进行对驱动变量是否被操控进行检验，因为rdrobust包未包含McCrary检验</p>
</blockquote>
<p><strong>示列数据集</strong>：采用rdrobust包中自带的<em>rdrobust_RDsenate</em>数据集：</p>
<ul>
<li>数据集简介：该数据集包含了1914–2010年间美国参议院选举的数据，可以利用RD的方法分析民主党赢得参议院席位对于在下次选举中获得的相同席位的影响。该数据共包含两个变量：<br>
&gt; + vote：记录了州级层面下的参议院议席中民主党所占的比例，值从0到100，是RD分析中结局变量 &gt; + margin：记录了民主党在上次选举中获得相同参议院席位的胜利边际，值从-100到100，当大于0时，说明民主党胜利，小于0则输了，是RD分析中的驱动变量</li>
</ul>
<section id="step-1-确定驱动变量rating-variable和断点cut-point" class="level4" data-number="5.7.6.1">
<h4 data-number="5.7.6.1" class="anchored" data-anchor-id="step-1-确定驱动变量rating-variable和断点cut-point"><span class="header-section-number">5.7.6.1</span> Step 1: 确定驱动变量(Rating variable)和断点(Cut-point)</h4>
<p>根据研究设计，判断是否存在采用RD进行因果识别或者效应估计的可能，即是否可以找到合适的驱动变量和明确的断点来识别施加干预的状态。</p>
<p>通常情况下时间（具体到天）、年龄（如研究退休，代表性的文章: <a href="http://cpfd.cnki.com.cn/Article/CPFDTOTAL-BDGF201007002017.htm">“退休影响会健康吗”</a>）、地理距离（研究雾霾，代表性文章: <a href="http://www.cnki.com.cn/Article/CJFDTOTAL-NKJJ201704002.htm">“冬季供暖导致雾霾？来自华北 城市面板的证据”</a>）比较容易作为驱动变量。</p>
</section>
<section id="step-2-内部有效性internal-validity条件的检验" class="level4" data-number="5.7.6.2">
<h4 data-number="5.7.6.2" class="anchored" data-anchor-id="step-2-内部有效性internal-validity条件的检验"><span class="header-section-number">5.7.6.2</span> Step 2: 内部有效性(Internal Validity)条件的检验</h4>
<p><strong>1) 条件一：通过画驱动变量的频率分布直方图或者密度分布图，以及McCrary检验</strong></p>
<p>可以利用graphics包或者ggplot2包画histogram图，也可以利用<strong>rddenstiy</strong>包中的<em>rddenstiy</em>函数画密度图，也可利用<strong>rdd</strong>包进行McCrary检验。</p>
<p><em>rddenstiy</em>函数的其他参数可以用默认值，输出结果中，最下面一行robust的p值大于0.05，就说明驱动变量未受到操纵。</p>
<ul>
<li>方法一</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdrobust)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rddensity)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rdrobust_RDsenate)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="at">x =</span> rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">30</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">'red'</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">'margin'</span>, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">'Frequance'</span>, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">'Histogram of Rating Variable'</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rd1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.1: Histogram of Rating Variable (1)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>方法二</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rdrobust_RDsenate) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> margin, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fill =</span> margin <span class="sc">&lt;</span> <span class="dv">0</span>), </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> <span class="st">'black'</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">binwidth =</span> <span class="dv">4</span>, <span class="at">boundary =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Histogram of the Rating varibale'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">'Number of Observation'</span>, </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">'Margin'</span>) <span class="sc">+</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">''</span>, </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">'red'</span>, <span class="st">'blue'</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">'Control'</span>, <span class="st">'Treat'</span>)) <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">9</span>, .<span class="dv">9</span>),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.background =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rd2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.2: Histogram of Rating Variable (2)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>方法三</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdplotdensity</span>(<span class="fu">rddensity</span>(rdrobust_RDsenate<span class="sc">$</span>margin),</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">X =</span> rdrobust_RDsenate<span class="sc">$</span>margin)<span class="sc">$</span>Estplot[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$data
list()
attr(,"class")
[1] "waiver"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-rd3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd3-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.3: Histogram of Rating Variable (3)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>2) 条件二三四根据研究设计及背景资料进行判断。</strong></p>
</section>
<section id="step-3-画驱动变量与干预的关系图判断sharp或者fuzzy类型" class="level4" data-number="5.7.6.3">
<h4 data-number="5.7.6.3" class="anchored" data-anchor-id="step-3-画驱动变量与干预的关系图判断sharp或者fuzzy类型"><span class="header-section-number">5.7.6.3</span> Step 3: 画驱动变量与干预的关系图，判断sharp或者fuzzy类型</h4>
<p>  画驱动变量与干预的散点图，判断是否为sharp或者fuzzy类型。可以看出本例中，干预在cut-point前后，有明确的界限，为sharp类型。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rdrobust_RDsenate<span class="sc">$</span>treatment <span class="ot">&lt;-</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(rdrobust_RDsenate<span class="sc">$</span>margin <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>rdrobust_RDsenate<span class="sc">$</span>color <span class="ot">&lt;-</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(rdrobust_RDsenate<span class="sc">$</span>margin <span class="sc">&lt;</span> <span class="dv">0</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'blue'</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'red'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> rdrobust_RDsenate<span class="sc">$</span>treatment, </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> rdrobust_RDsenate<span class="sc">$</span>color,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">'p'</span>, </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">'Margin'</span>, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">'Treatment'</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">'Relationship between </span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="st">             rating variable and treatment'</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rd4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd4-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.4: Relationship between rating variable and treatment</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-4-画驱动变量与结果变量的关系图选择合适的bin数量" class="level4" data-number="5.7.6.4">
<h4 data-number="5.7.6.4" class="anchored" data-anchor-id="step-4-画驱动变量与结果变量的关系图选择合适的bin数量"><span class="header-section-number">5.7.6.4</span> Step 4: 画驱动变量与结果变量的关系图，选择合适的bin数量</h4>
<p><strong>一、画散点图</strong></p>
<p>  横轴为驱动变量，纵轴为结果变量，画散点图，初步判断两者之间关系，但是散点图噪音(noise)太大，不利于发现跳跃点，需要对驱动变量分不同的段(intervals or bin)将使得关系取线更平顺。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 第一步：散点图</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">'p'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> rdrobust_RDsenate<span class="sc">$</span>color, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">'Margin'</span>, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">'Vote'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rd5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd5-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.5: 散点图</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>二、将驱动变量分段的步骤</strong></p>
<p>  将驱动变量分段后再做关系图，大致有四步：</p>
<ul>
<li>将驱动变量分成若干宽度(width)相等的区间(bin)，但是需要注意的是不能存在骑跨cut-point的区间， 所以最好从cut-point开始分别向左右两端进行划分，并不一定要求左右两边的bin数量相等。<br>
</li>
<li>计算每个bin中的结局变量的平均值、驱动变量的中位数，以及个体的数量(num of observation)</li>
<li>将驱动变量的中位数作为横轴，将结局变量的平均值作为纵轴，同时用每个bin中个体的数量进行加权</li>
<li>为了更好的显示两变量之间的关系，最好加上局部加权平滑回归取线(如：lowess: locally weighted regression)</li>
</ul>
<p><strong>三、确定bins数量的方法</strong></p>
<p>  如何设定bin的数量或者binwidth的方法比较复杂，bin的数量不宜过多或过少，过少起不到将噪音的作用，过多会导致jump不明显，在Stata和R中有打包的好的方法去判断bin的数量，本例中采用<strong>rdrobust</strong>包中的<em>rdplot</em>函数进行判断。</p>
<p><strong><em>rdplot</em>函数的常用参数有</strong>：</p>
<ul>
<li>c为cut-point，默认为0</li>
<li>p为全局多项式的幂次方，默认为4</li>
<li>nbins用来设定断点左右的bin的数量，默认为NULL</li>
<li>kernel用来设定加权方法，默认为uniform，同时还有triangular和epanechnikov方法</li>
<li>binselect为判断方法，默认为’esmv’，</li>
</ul>
<p>判断方法常用一共4种：Evenly-spaced (es)，Quantile-spaced (qs)，以及结合mimicking-variance (MV)的esmv和qsmv，推荐使用qs方法。<strong>p和nbin如果不确定也可缺失，让binselect方法自行设定</strong>，从结果可以看出总的样本量，以及cut-point左右的样本量，以及设定的bin的数量。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bins <span class="ot">&lt;-</span> <span class="fu">rdplot</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>               rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">4</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">nbins =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>), </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">binselect =</span> <span class="st">'esmv'</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">kernel =</span> <span class="st">'uniform'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: rdplot

Number of Obs.                 1297
Kernel                      Uniform

Number of Obs.                  595             702
Eff. Number of Obs.             595             702
Order poly. fit (p)               4               4
BW poly. fit (h)            100.000         100.000
Number of bins scale              1               1

Bins Selected                    20              20
Average Bin Length            5.000           5.000
Median Bin Length             5.000           5.000

IMSE-optimal bins                 8               9
Mimicking Variance bins          15              35

Relative to IMSE-optimal:
Implied scale                 2.500           2.222
WIMSE variance weight         0.060           0.084
WIMSE bias weight             0.940           0.916</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-rd6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd6-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.6: 确定bins数量的方法</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-5-模型估计效应大小" class="level4" data-number="5.7.6.5">
<h4 data-number="5.7.6.5" class="anchored" data-anchor-id="step-5-模型估计效应大小"><span class="header-section-number">5.7.6.5</span> Step 5: 模型估计效应大小</h4>
<p><strong>1) 效应大小的估计方法一共有两种：</strong></p>
<ul>
<li>全局参数估计(Parametric/global strategy): 即是利用全部个体的数据，对驱动变量和结局变量拟合线性、二次项、三次项、四次项回归模型，此方法利用的是RD设计的”断点处不连续(discontinuity at a cut-point)“的特性。模型设定如下：</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
Y_i = &amp; \alpha + \beta_0 \cdot Treatment_i + \beta_1 \cdot (rating_i - cutpoint)^k + \\
      &amp; \beta_3 \cdot Treatment_i \cdot (rating_i - cutpoint)^k + \\
      &amp; \beta_4 \cdot Confouders_i + \epsilon_i
\end{aligned}
\]</span></p>
<ul>
<li><strong>式中</strong>：
<ol type="1">
<li>Y为结局变量，<span class="math inline">\(\alpha\)</span> 为常数项，表示在控制驱动变量后干预组结局变量的平均值，k为多项式的幂次，通常为1到4次方，其他参数含义见字面意思，</li>
<li><span class="math inline">\(\beta_0\)</span>就是核心关注的系数，表示干预措施在断点处的边际效应，也就是干预的处理效应。<br>
</li>
<li>而如何选择合适的次项数，需要多次尝试，通过比较AIC，选择AIC最小的模型。</li>
<li>驱动变量减去cutpoint的目的是为了中心化，为了使<span class="math inline">\(\alpha\)</span>反映的是断点处的平均值，因为差值在断点处为0</li>
<li>Confouders为混杂因素，也可以加入模型中，但是中RD分析时，混杂因素的控制不是必须的。</li>
</ol></li>
<li>局部非参数估计(Nonparametric/local strategy): 即是在cut-point左右选择一段合适的带宽(bandwidth)，在这一段带宽局部范围内， 拟合驱动变量和结局变量的线性或者多项式回归模型，此方法利用的是RD设计的”局部随机(local randomization)“的特性。此方法适用于样本量较大的情况， 因为样本量太少，设定带宽之后样本量将会不足，增加估计误差。前面所提到的R包中均只提供局部非参数估计函数。<strong>局部非参数估计的难点在于如何确定最优带宽，常用的方法有交叉验证法(cross validation procedure， CV)、 IK 法和 CCT 法，后两种方法较为推荐</strong></li>
</ul>
<p>  <strong>关于上述两种方法的比较或者权衡，主要是关于精度和误差，全局参数估计因为利用了全部样本，通常对效应的估计精度更高</strong>，然而其也存在一个问题，就是驱动变量和结局变量的关系函数在越大的区间下越难以准确识别；而非参数估计可以通过局部拟合加权线性或者多项式回归模型而减少这种偏误。</p>
<p>  <strong>以上方法主要针对sharp类型，fuzzy类型的估计方法见最后一节。</strong></p>
<p><strong>2) 全局参数估计</strong></p>
<p>  分为一次线性、一次线性加交互项、以及二次、三次线性及交互项，共6个模型，比较AIC或者回归残差，较小者模型较优。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rdrobust_RDsenate<span class="sc">$</span>margin_del <span class="ot">&lt;-</span> rdrobust_RDsenate<span class="sc">$</span>margin <span class="sc">-</span> <span class="dv">0</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># linear</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>fit_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin_del <span class="sc">+</span> treatment, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># linear interaction</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>fit_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin_del <span class="sc">*</span> treatment, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratic</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>fit_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin_del <span class="sc">+</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> treatment, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratic interaction</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>fit_4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> (margin_del <span class="sc">+</span> <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">*</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                   treatment, </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># cubic</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>fit_5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin_del <span class="sc">+</span> <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">3</span>) <span class="sc">+</span> treatment, </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># cubic interaction</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>fit_6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> (margin_del <span class="sc">+</span> <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">3</span>)) <span class="sc">*</span> treatment, </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Linear"</span> <span class="ot">=</span> fit_1, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Linear interaction"</span> <span class="ot">=</span> fit_2, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Quadratic"</span> <span class="ot">=</span> fit_3), </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">stars =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-rd1" class="anchored">

<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"><caption>表&nbsp;5.1:  全局参数估计 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Linear </th>
   <th style="text-align:center;"> Linear interaction </th>
   <th style="text-align:center;"> Quadratic </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 47.331*** </td>
   <td style="text-align:center;"> 44.904*** </td>
   <td style="text-align:center;"> 45.486*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.542) </td>
   <td style="text-align:center;"> (0.699) </td>
   <td style="text-align:center;"> (0.616) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> margin_del </td>
   <td style="text-align:center;"> 0.348*** </td>
   <td style="text-align:center;"> 0.216*** </td>
   <td style="text-align:center;"> 0.285*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.013) </td>
   <td style="text-align:center;"> (0.028) </td>
   <td style="text-align:center;"> (0.017) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatment </td>
   <td style="text-align:center;"> 4.785*** </td>
   <td style="text-align:center;"> 6.044*** </td>
   <td style="text-align:center;"> 6.663*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.923) </td>
   <td style="text-align:center;"> (0.942) </td>
   <td style="text-align:center;"> (0.963) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> margin_del × treatment </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.170*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.032) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> I(margin_del^2) </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.001*** </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.0002) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 1297 </td>
   <td style="text-align:center;"> 1297 </td>
   <td style="text-align:center;"> 1297 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.578 </td>
   <td style="text-align:center;"> 0.587 </td>
   <td style="text-align:center;"> 0.590 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.577 </td>
   <td style="text-align:center;"> 0.586 </td>
   <td style="text-align:center;"> 0.589 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 10083.7 </td>
   <td style="text-align:center;"> 10056.7 </td>
   <td style="text-align:center;"> 10049.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 10104.4 </td>
   <td style="text-align:center;"> 10082.5 </td>
   <td style="text-align:center;"> 10075.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −5037.848 </td>
   <td style="text-align:center;"> −5023.354 </td>
   <td style="text-align:center;"> −5019.946 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 886.433 </td>
   <td style="text-align:center;"> 613.586 </td>
   <td style="text-align:center;"> 619.091 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 11.77 </td>
   <td style="text-align:center;"> 11.64 </td>
   <td style="text-align:center;"> 11.61 </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
</table>

</div>
</div>
</div>
<p><strong>3) 局部非参数估计</strong></p>
<p>  利用<strong>rdrobust</strong>包的<em>rdrobust</em>函数进行拟合。由于该包是由Sebastian Calonico, Matias D. Cattaneo and Rocío Titiunik开发，所以该包中所提供的带宽选择方法可认为就是CCT法，因为CCT本来就是Calonico, Cattaneo, and Titiunik三人姓氏的缩写。</p>
<p><strong>有两种确定带宽的方法</strong>：</p>
<ul>
<li>一是先利用<em>rdbwselect</em>函数计算出最优带宽，然后用<em>rdrobust</em>函数中的h参数手动指定左右的带宽。<br>
</li>
<li>二是直接利用<em>rdrobust</em>函数中的bdselect参数指定选择最优带宽的方法。</li>
</ul>
<p><strong>rdrobust</strong>包中一共提供了10种选择最优带宽的方法，如下:</p>
<ul>
<li><p>其中，共包含MSE = Mean Square Error和CER = Coverage Error Rate两大类，MSE更适用于进行点估计的带宽选择， 而CER更适合区间估计的带宽选择。</p></li>
<li><p>以rd结尾是表示选择的带宽在cut-point左右相等，而以two结尾是表示选择的带宽在cut-point左右不相等。</p></li>
<li><p>h即为选择的左右最优带宽，而b给出的是用来进行敏感性分析时应该考虑的带宽。</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdbwselect</span>(<span class="at">y =</span> rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: rdbwselect

Number of Obs.                 1297
BW type                         All
Kernel                   Triangular
VCE method                       NN

Number of Obs.                  595          702
Order est. (p)                    1            1
Order bias  (q)                   2            2
Unique Obs.                     595          665

=======================================================
                  BW est. (h)    BW bias (b)
            Left of c Right of c  Left of c Right of c
=======================================================
     mserd    17.754     17.754     28.028     28.028
    msetwo    16.170     18.126     27.104     29.344
    msesum    18.365     18.365     31.319     31.319
  msecomb1    17.754     17.754     28.028     28.028
  msecomb2    17.754     18.126     28.028     29.344
     cerrd    12.407     12.407     28.028     28.028
    certwo    11.299     12.667     27.104     29.344
    cersum    12.834     12.834     31.319     31.319
  cercomb1    12.407     12.407     28.028     28.028
  cercomb2    12.407     12.667     28.028     29.344
=======================================================</code></pre>
</div>
</div>
<p>  虽然在此文中<a href="https://journal.r-project.org/archive/2015/RJ-2015-004/RJ-2015-004.pdf">rdrobust: An R Package for Robust Nonparametric Inference in Regression-Discontinuity Designs</a>提到也可以通过bdselect = ’CV’或者bdselect = ’IK’来采用CV和IK法，但是在写这篇笔记时，已无法使用这两种方法。</p>
<p>输出的结果的最后一张表的第一行Conventional即为干预的处理效应。</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果有混杂因素需要控制,可以用covs = c('var1', 'var2')</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>loc_fit_1 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># c用来指定cut-point，p用来指定局部加权回归的多项式幂次</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>loc_fit_2 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">2</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>loc_fit_3 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'cerrd'</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>loc_fit_4 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">2</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'certwo'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(loc_fit_1, loc_fit_2,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                  loc_fit_3, loc_fit_4),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> <span class="st">"std.error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-rd2" class="anchored">

<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"><caption>表&nbsp;5.2:  局部非参数估计 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
   <th style="text-align:center;"> Model 3 </th>
   <th style="text-align:center;"> Model 4 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Conventional </td>
   <td style="text-align:center;"> 1.497*** </td>
   <td style="text-align:center;"> 1.852*** </td>
   <td style="text-align:center;"> 1.680*** </td>
   <td style="text-align:center;"> 2.209*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.497) </td>
   <td style="text-align:center;"> (1.852) </td>
   <td style="text-align:center;"> (1.680) </td>
   <td style="text-align:center;"> (2.209) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bias-Corrected </td>
   <td style="text-align:center;"> 1.497*** </td>
   <td style="text-align:center;"> 1.852*** </td>
   <td style="text-align:center;"> 1.680*** </td>
   <td style="text-align:center;"> 2.209*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.497) </td>
   <td style="text-align:center;"> (1.852) </td>
   <td style="text-align:center;"> (1.680) </td>
   <td style="text-align:center;"> (2.209) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Robust </td>
   <td style="text-align:center;"> 1.759*** </td>
   <td style="text-align:center;"> 2.056*** </td>
   <td style="text-align:center;"> 1.841*** </td>
   <td style="text-align:center;"> 2.282*** </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.759) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (2.056) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.841) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (2.282) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Kernel </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bandwidth </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> cerrd </td>
   <td style="text-align:center;"> certwo </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
</table>

</div>
</div>
</div>
</section>
<section id="step-6-敏感性分析" class="level4" data-number="5.7.6.6">
<h4 data-number="5.7.6.6" class="anchored" data-anchor-id="step-6-敏感性分析"><span class="header-section-number">5.7.6.6</span> Step 6: 敏感性分析</h4>
<p>  敏感性分析主要用来检验模型估计结果的稳健性，RD分析主要有四种敏感性分析方式;</p>
<ol type="1">
<li><p>对前面所述的Internal Validity条件三的检验，即除了干预(Treatment)变量外，其他的任何非结局变量(包括混杂因素在内)都不能在cut-point处出现不连续或称为跳跃，如果存在，则无法推断结局变量的跳跃是由干预(Treatment)引起的，检验方式就是将所有的混杂因素作为结局，利用<em>rdrobust</em>函数进行检验，输出结果的coef应该很小，且p值应该统计学不显著 (Continuity-Based Analysis for Covariates)。</p></li>
<li><p>对cut-point的敏感性分析，即是更换cut-point，检验是否左右还存在处理效应，如果更换断点后，仍然存在处理效应，则无法说明本研究的干预措施是有效的，因为在研究设定的断点处识别到的处理效应，有可能是由其他因素引起的。</p></li>
<li><p>对cut-point附近个体的敏感性分析，在Internal Validity条件一中提到，驱动变量不可被操控，但是这个无法直接检验，因此，换个思路，如果驱动变量被超控，那自然是在cut-point左右离得最近的值被操纵的可能性最大，所以如果将这部分个体剔除，若仍然能观测到处理效应，则说明这种效应是真实由干预所导致。这种方法被称为甜甜圈(donut hole)法，同样也适用于个体过多的堆积与cut-point附近的RD分析。</p></li>
<li><p>对带宽bandwidth的敏感性分析，即是cut-point不改变，而是更换选择的最优带宽，进行多次局部非参数检验，如果更换带宽之后，仍然能在断点处识别的处理效应，说明研究的干预措施是有效的，因为在研究设定的断点处识别到的处理效应不是由于某一特点的带宽下才观测到的，说明处理效应稳健。</p></li>
</ol>
<p><strong>1) 对cut-point的敏感性分析</strong></p>
<p>  选择一个虚拟的断点用来替换真正的断点，但是真实的干预情况不改变。关于虚拟断点如何选择以及选择多少个并没有明确的标准，通常在真实断点的附近，左右对称选取即可</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sen_cut_1 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>sen_cut_2 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(sen_cut_1, sen_cut_2), </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> <span class="st">"std.error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-rd3" class="anchored">

<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"><caption>表&nbsp;5.3:  对cut-point的敏感性分析 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Conventional </td>
   <td style="text-align:center;"> 1.406*** </td>
   <td style="text-align:center;"> 1.614 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.406) </td>
   <td style="text-align:center;"> (1.614) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bias-Corrected </td>
   <td style="text-align:center;"> 1.406*** </td>
   <td style="text-align:center;"> 1.614 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.406) </td>
   <td style="text-align:center;"> (1.614) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Robust </td>
   <td style="text-align:center;"> 1.640** </td>
   <td style="text-align:center;"> 1.865 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.640) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.865) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Kernel </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bandwidth </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> msetwo </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
</table>

</div>
</div>
</div>
<p><strong>2) 对cut-point附近个体的敏感性分析</strong></p>
<p>  对称剔除真实断点左右一定较小范围内的个体。关于范围的大小同样没有明确的标准，通常选取多个范围比较即可。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rdrobust_RD_hole_1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(rdrobust_RDsenate, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">abs</span>(margin) <span class="sc">&gt;</span> <span class="fl">0.3</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>rdrobust_RD_hole_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(rdrobust_RDsenate, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">abs</span>(margin) <span class="sc">&gt;</span> <span class="fl">0.4</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>rdrobust_RD_hole_3 <span class="ot">&lt;-</span> <span class="fu">subset</span>(rdrobust_RDsenate, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">abs</span>(margin) <span class="sc">&gt;</span> <span class="fl">0.5</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>sen_hole_1 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RD_hole_1<span class="sc">$</span>vote, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                       rdrobust_RD_hole_1<span class="sc">$</span>margin, </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>sen_hole_2 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RD_hole_2<span class="sc">$</span>vote, </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                       rdrobust_RD_hole_2<span class="sc">$</span>margin, </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>sen_hole_3 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RD_hole_3<span class="sc">$</span>vote, </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                       rdrobust_RD_hole_3<span class="sc">$</span>margin, </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(sen_hole_1, sen_hole_2, sen_hole_3), </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> <span class="st">"std.error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-rd4" class="anchored">

<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"><caption>表&nbsp;5.4:  对cut-point附近个体的敏感性分析 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
   <th style="text-align:center;"> Model 3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Conventional </td>
   <td style="text-align:center;"> 1.558*** </td>
   <td style="text-align:center;"> 1.558*** </td>
   <td style="text-align:center;"> 1.591*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.558) </td>
   <td style="text-align:center;"> (1.558) </td>
   <td style="text-align:center;"> (1.591) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bias-Corrected </td>
   <td style="text-align:center;"> 1.558*** </td>
   <td style="text-align:center;"> 1.558*** </td>
   <td style="text-align:center;"> 1.591*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.558) </td>
   <td style="text-align:center;"> (1.558) </td>
   <td style="text-align:center;"> (1.591) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Robust </td>
   <td style="text-align:center;"> 1.839*** </td>
   <td style="text-align:center;"> 1.860*** </td>
   <td style="text-align:center;"> 1.918*** </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.839) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.860) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.918) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Kernel </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bandwidth </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> msetwo </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
</table>

</div>
</div>
</div>
<p><strong>3) 对带宽bandwidth的敏感性分析</strong></p>
<p>  即是更换不同的带宽即可，带宽的变化实际是cut-point区间范围尾部的个体在发生变化，可以通过选取不同的带宽选择方式，真实存在的处理效应不会随着带宽的改变而发生变化。</p>
</section>
</section>
<section id="关于fuzzy类型的rd模型估计方法" class="level3" data-number="5.7.7">
<h3 data-number="5.7.7" class="anchored" data-anchor-id="关于fuzzy类型的rd模型估计方法"><span class="header-section-number">5.7.7</span> 关于Fuzzy类型的RD模型估计方法</h3>
<p>  Fuzzy类型的RD可以根据驱动变量与干预的实际情况采取不同的处理方式:</p>
<ul>
<li><p>如果只是no-shows的情况，可以结合研究目的，决定是否采取意向性分析法(intent-to-treat)</p></li>
<li><p>采用两阶段回归two-stage least squares (2SLS) ，两阶段模型设定如下:</p>
<ul>
<li><p>第一阶段：<br>
<span class="math display">\[ Treatment_i = \alpha_1 + \gamma_0 \cdot treat-by-cutpoint_i + \epsilon_i \]</span></p></li>
<li><p>第二阶段：<br>
<span class="math display">\[ Y_i = \alpha_i + \beta_0 \cdot \dot Treatment + \mu_i \]</span></p>
<ul>
<li>其中：
<ol type="1">
<li><span class="math inline">\(Treatment_i\)</span>为真实的干预情况</li>
<li><span class="math inline">\(treat-by-cutpoint_i\)</span>是指驱动变量根据cut-point判断的是否接受了干预，为虚拟变量</li>
<li>第二阶段模型中的<span class="math inline">\(\dot Treatment\)</span>将第一阶段模型的预测指yhat</li>
</ol></li>
</ul></li>
</ul></li>
</ul>
<p>通过两阶段回归，第二阶段中的Standard errors是经过了调整的。<strong>在<em>rdrobust</em>包的rdrobust函数中，有一个<code>fuzzy</code>的逻辑参数，用来指定RD类型是否为fuzzy，可以很方便的进行fuzzy类型的模型估计。</strong></p>
</section>
<section id="结束" class="level3" data-number="5.7.8">
<h3 data-number="5.7.8" class="anchored" data-anchor-id="结束"><span class="header-section-number">5.7.8</span> 结束</h3>
<p>  由于真实世界的复杂性，对因果推断的分析方法的要求也越来越高，没有一种方法可以适用所有的情形，因此RD的方法也衍生发展出很多类型，包括多个断点(Multi-Cutoff RD Design)、多个驱动变量(Multi-Score RD Design)、离散驱动变量(Multi-Score RD Design)等等。</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-ashenfelter1985" class="csl-entry" role="doc-biblioentry">
Ashenfelter, Orley, and David Card. 1985. <span>“Using the <span>Longitudinal Structure</span> of <span>Earnings</span> to <span>Estimate</span> the <span>Effect</span> of <span>Training Programs</span>.”</span> <em>The Review of Economics and Statistics</em> 67 (4): 648. <a href="https://doi.org/10.2307/1924810">https://doi.org/10.2307/1924810</a>.
</div>
<div id="ref-Sebastian2022" class="csl-entry" role="doc-biblioentry">
Calonico, Sebastian, Matias D. Cattaneo, Max H. Farrell, and Rocio Titiunik. 2022. <em>Rdrobust: Robust Data-Driven Statistical Inference in Regression-Discontinuity Designs</em>. <a href="https://CRAN.R-project.org/package=rdrobust">https://CRAN.R-project.org/package=rdrobust</a>.
</div>
<div id="ref-matias2017" class="csl-entry" role="doc-biblioentry">
D. Cattaneo, Matias, Nicolas Idroboy, and Roc Titiunik. 2017. <em>A Practical Introduction to Regression Discontinuity Designs: Volume i</em>. collingwoodresearch.com.
</div>
<div id="ref-jacob2012" class="csl-entry" role="doc-biblioentry">
Jacob, Robin, Pei Zhu, and Marie-Andrée. 2012. <em>A Practical Guide to Regression Discontinuity</em>. MDRC.org.
</div>
<div id="ref-rubin1980" class="csl-entry" role="doc-biblioentry">
Rubin, Donald B. 1980. <span>“Andomization Analysis of Experimental Data in the Fisher Randomization Test.”</span> <em>Journal American Statistical Association</em> 75 (371). <a href="https://www.jstor.org/stable/">https://www.jstor.org/stable/</a>.
</div>
<div id="ref-xie2019" class="csl-entry" role="doc-biblioentry">
谢谦, 薛仙玲, and 付明卫. 2019. <span>“断点回归设计方法应用的研究综述.”</span> <em>经济与管理评论</em> 35 (2): 11.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter_4.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">数据的描述</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter_6.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">番外篇（一）：随机化分组</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2023 Chi Shen, Xi'an Jiaotong University
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>