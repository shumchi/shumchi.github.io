<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>卫生政策实证研究手册 - 5&nbsp; 因果推断方法</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter_6.html" rel="next">
<link href="./chapter_4.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">因果推断方法</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">卫生政策实证研究手册</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">前言</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">文献知识的获取与管理</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">数据库操作</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">数据的清洗</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">数据的描述</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_5.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">因果推断方法</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">番外篇（一）：随机化分组</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">番外篇（二）：主成分分析</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_references.html" class="sidebar-item-text sidebar-link">参考文献</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#双重差分" id="toc-双重差分" class="nav-link active" data-scroll-target="#双重差分"><span class="toc-section-number">5.1</span>  双重差分</a></li>
  <li><a href="#工具变量" id="toc-工具变量" class="nav-link" data-scroll-target="#工具变量"><span class="toc-section-number">5.2</span>  工具变量</a></li>
  <li><a href="#断点回归" id="toc-断点回归" class="nav-link" data-scroll-target="#断点回归"><span class="toc-section-number">5.3</span>  断点回归</a>
  <ul class="collapse">
  <li><a href="#简介" id="toc-简介" class="nav-link" data-scroll-target="#简介"><span class="toc-section-number">5.3.1</span>  简介</a></li>
  <li><a href="#发展历史" id="toc-发展历史" class="nav-link" data-scroll-target="#发展历史"><span class="toc-section-number">5.3.2</span>  发展历史</a></li>
  <li><a href="#特点与分类" id="toc-特点与分类" class="nav-link" data-scroll-target="#特点与分类"><span class="toc-section-number">5.3.3</span>  特点与分类</a></li>
  <li><a href="#适用rd分析的先决条件conditions-for-internal-validity" id="toc-适用rd分析的先决条件conditions-for-internal-validity" class="nav-link" data-scroll-target="#适用rd分析的先决条件conditions-for-internal-validity"><span class="toc-section-number">5.3.4</span>  适用RD分析的先决条件(Conditions for Internal Validity)</a></li>
  <li><a href="#断点回归的图形分析graphical-presentations-in-the-rd" id="toc-断点回归的图形分析graphical-presentations-in-the-rd" class="nav-link" data-scroll-target="#断点回归的图形分析graphical-presentations-in-the-rd"><span class="toc-section-number">5.3.5</span>  断点回归的图形分析(Graphical Presentations in the RD)</a></li>
  <li><a href="#进行rd分析的步骤及示例" id="toc-进行rd分析的步骤及示例" class="nav-link" data-scroll-target="#进行rd分析的步骤及示例"><span class="toc-section-number">5.3.6</span>  进行RD分析的步骤及示例</a></li>
  <li><a href="#关于fuzzy类型的rd模型估计方法" id="toc-关于fuzzy类型的rd模型估计方法" class="nav-link" data-scroll-target="#关于fuzzy类型的rd模型估计方法"><span class="toc-section-number">5.3.7</span>  关于Fuzzy类型的RD模型估计方法</a></li>
  <li><a href="#结束" id="toc-结束" class="nav-link" data-scroll-target="#结束"><span class="toc-section-number">5.3.8</span>  结束</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">因果推断方法</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="双重差分" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="双重差分"><span class="header-section-number">5.1</span> 双重差分</h2>
<p>  先说为什么会想着写这本书：</p>
<ul>
<li><p>一是因为这么多年学习和研究的领域是卫生管理（Health Management）与卫生政策（Health Policy），在研究方法方面一直是受卫生统计学或者应用统计学的影响比较大，但是近些年随着<strong>因果推断革命（Causal Inference Revolution）</strong>对各个学科在研究方法上的强烈冲击，特别是社会科学，卫生政策领域的研究在方法学上也受到计量经济学非常大的影响，其中被国内外学者使用最广泛的应该就当属双重差分（Difference-in-Difference）了；</p></li>
<li><p>二是因为我本人的学科背景并非为经济学，所以很多计量经济学的方法都是在当研究需要时一点一点自学的，尽管计量经济学与统计学存在很多的渊源，但毕竟理论体系不太一样，这就导致在碎片化自学过程中难免会犯一些错误和走一些弯路，再加上这些年记忆力不比从前，对”烂笔头”的依赖越来越高，因此就索性把这些年攒下来的一些笔记，加上最近更新的一些关于DID的知识点整理出来了；</p></li>
<li><p>三是最近几年随着微信公众号和知乎等迅速成为各类信息传播的主要平台，国内科研工作者慢慢的很少”逛”论坛、发帖子、写博客了，有的转战公众号开设自己的账号，有的开始团队运营，这些平台给科学研究提供了不少便利性，扩大了知识获取面，降低了知识检索的时间成本，但是其弊端也毕竟明显，一方面是导致很多人对前沿科学咨讯的获取基本来源于公众号，很少阅读原始文献，另一方面是公众号或者知乎平台分享的信息和知识点没有经过同行评议，其实不乏有错误之处，若不加思索的参考或者照搬很容易导致研究方法误用，特别是对于尚处于学术生涯初期的研究生。</p></li>
</ul>
<p>时刻更新自己的知识体系是科研工作者日常生活中的一部分，保持对新知识的学习热情应该是一个合格的打工人的基本素养吧。DID早在20世纪80年代就被提出，其基本原理很简单，但是如果据此就认为采用DID识别框架的方法都很简单就错了，随着Joshua D. Angrist、Guido W. Imbens、Gary King、Susan Athey等经济学和统计学家对因果识别方法体系的贡献，时至今日，DID已经衍生出了多种多样的类型来使用不同的研究设计和数据结构，可以说已经是一大方法家族了吧。</p>
<p>写这本书就是打算能给卫生管理和卫生政策方向的年轻硕士和博士生在研究中以参考，因此这本书注重实践性。在这本书里面打算既介绍DiD的原理也给出完整的分析方法和过程，由于目前我还写不清楚所以不会涉及详细的数理推导。</p>
<p><strong>本书的主要参考资料如下：</strong></p>
<blockquote class="blockquote">
<ol type="1">
<li>Angrist, &amp; JoshuaDavid. (2010). Mostly Harmless Econometrics: An Empiricist Companion. Princeton University Press.</li>
<li>伍德里奇, &amp; 费剑平校. (2010). 计量经济学导论: 第4版. 中国人民大学出版社.</li>
<li>Scott Cunningham. (2020). Causal Inference: The Mixtape. Yale University Press.</li>
<li><a href="https://lost-stats.github.io/Model_Estimation/Research_Design/event_study.html" class="uri">https://lost-stats.github.io/Model_Estimation/Research_Design/event_study.html</a></li>
</ol>
</blockquote>
</section>
<section id="工具变量" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="工具变量"><span class="header-section-number">5.2</span> 工具变量</h2>
</section>
<section id="断点回归" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="断点回归"><span class="header-section-number">5.3</span> 断点回归</h2>
<section id="简介" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="简介"><span class="header-section-number">5.3.1</span> 简介</h3>
<p>  断点回归（Regression Discontinuity）适用于以下情形：人群是否接受干预（Treatment）是依据某一数值变量（rating variable）是否高于或低于某一确定的阈值（threshold）或者分割点（cut-point），例如在研究是否上大学会影响收入时，数值变量（rating variable，也叫 assignment variable，score，running variable，forcing variable， or index）就是高考分数，阈值或者分割点就是本科录取分数线。以下内容主要参考：<span class="citation" data-cites="Sebastian2022 matias2017 jacob2012 xie2019">(<a href="chapter_references.html#ref-Sebastian2022" role="doc-biblioref">Calonico et al. 2022</a>; <a href="chapter_references.html#ref-matias2017" role="doc-biblioref">D. Cattaneo, Idroboy, and Titiunik 2017</a>; <a href="chapter_references.html#ref-jacob2012" role="doc-biblioref">Jacob, Zhu, and Marie-Andrée 2012</a>; <a href="chapter_references.html#ref-xie2019" role="doc-biblioref">谢谦, 薛仙玲, and 付明卫 2019</a>)</span>。</p>
</section>
<section id="发展历史" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="发展历史"><span class="header-section-number">5.3.2</span> 发展历史</h3>
<p>  Regression Discontinuity最早由社会学家Thistlethwaite and Campbell 在1960年提出的，用于评估社会项目，但是他们的研究虽然引起一些影响但是没有得到广泛的注意，后来，在1972-2009年期间，被一系列经济学家(Goldberger，van der Klaauw，Imbens and Kalyanaraman等)在方法学方面进行了完善，最终在2008年达到顶峰，标志是在2008年Journal of Econometrics出了一期RD分析的<a href="https://www.sciencedirect.com/journal/journal-of-econometrics/vol/142/issue/2">Special Issue</a>，光看期刊名字就知道是经济学顶刊了(<strong>Journal of Econometrics是公认的计量经济学顶尖期刊，是教育部认可的12本经济学国际顶级期刊之一</strong> )。</p>
</section>
<section id="特点与分类" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="特点与分类"><span class="header-section-number">5.3.3</span> 特点与分类</h3>
<p><strong>RD有两个特点：</strong></p>
<ul>
<li>在Rating variable的一个明确点上，outcome出现了跳跃或者不连续(discontinuity at a cut-point)</li>
<li>可以认为在一个限定的rating variable区间上，个体是服从局部随机的(local randomization)</li>
</ul>
<p><strong>RD有两种类型：</strong></p>
<ul>
<li><p>精确断点(sharp design): 即所有个体(All subject)在明确的cut-point之后全部接受干预(treatment)</p></li>
<li><p>模糊断点(fuzzy design): 即在cut-point前后，存在 no-shows (treatment group members who do not receive the treatment)或者crossovers (control group members who do receive the treatment) ，换句话说就无法找到一个明确的cut-point完全区分干预和对照组。更严格的分法是，fuzzy也可以分成两类：type I是no-shows，只存在处理组有未接受处理的个体，type II是同时存在no-shows和crossovers。实际就是RCT中常说的沾染问题。</p></li>
</ul>
</section>
<section id="适用rd分析的先决条件conditions-for-internal-validity" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="适用rd分析的先决条件conditions-for-internal-validity"><span class="header-section-number">5.3.4</span> 适用RD分析的先决条件(Conditions for Internal Validity)</h3>
<p>  由于RD仍然属于非实验方法，尽管也被成为类实验(quasi-experimental)，但本质还是非实验方法(nonexperimental)， 所以它必须满足一系列前期条件，才能提供无偏估计和更可能的接近RCT的严格情形。</p>
<ul>
<li><p><strong>一、</strong> Rating variable (中文的翻译很多，但比较通用的翻译为驱动变量或者配置变量)不能被干预(treatment)所影响，Rating variable 的值必须是在干预(treatment)<strong>之前</strong>就已经确定了，或者是不可再更改的变量。也就是只能是驱动变量的值决定是否接受干预，不能是干预决定驱动变量的值。比如：高考成绩(Rating variable)是在判断是否能够上大学(treatment)之前就已经确定了，并且分数不会再发生变化，如果存在严重的根据分数线修改高考成绩的情况，则高考分数就不能作为Rating variable。 <strong>检验方法是：画Rating variable的频率分布直方图或者密度图，再进行McCrary 检验</strong></p></li>
<li><p><strong>二、</strong> 断点(cut-point)是完全外生的，并且干预与否完全取决于驱动变量和断点。即断点不受其他因素影响而改变干预的判断，即把本不该接受干预的对象划入了干预，或者把该接受干预的对象划入了对照。 比如，如果高考录取线(cut-point)的确定是完全已经严格的录取指标划定的， 而不存在为了使得某部分人群能够获得上大学的机会，而修改录取线。</p></li>
<li><p><strong>三、</strong> 在驱动变量的cut-point前后，除了干预与否(treatment)是不连续或者跳跃的(比如断点前为0，断点后为1)，其他任何因素都不能出现不连续或者跳跃(Nothing other than treatment status is discontinuous in the analysis interval)，因为要保证outcome的跳跃只能是干预的不连续或者跳跃导致的。比如，如果高考分数线除了决定是否能上大学外，还决定是否享有创业扶持机会，那么如果研究上大学对某种结局的影响，就无法分离出到底是大学教育导致，还是获得创业扶持机会导致的。</p></li>
<li><p><strong>四、</strong> 驱动变量(rating variable)与结局变量(outcome)之间的函数关系应该是连续的，严格的说，应该是在进行RD分析的这段区间内(interval)是连续的。换句话说就是，如果不存在干预的情况，驱动变量与结局变量之间不会出现不连续或者跳跃，才能在结局变量出现不连续的情况下，反推出是干预引起的，因为只有干预是不连续的。<strong>注意：此条件只需要在选择参数估计方法是要满足(applies only to parametric estimators)</strong></p></li>
</ul>
</section>
<section id="断点回归的图形分析graphical-presentations-in-the-rd" class="level3" data-number="5.3.5">
<h3 data-number="5.3.5" class="anchored" data-anchor-id="断点回归的图形分析graphical-presentations-in-the-rd"><span class="header-section-number">5.3.5</span> 断点回归的图形分析(Graphical Presentations in the RD)</h3>
<p><strong>图形分析是进行RD的第一步，也是非常重要的组成部分</strong></p>
<p><strong>通常，进行RD至少需要画4种图：</strong></p>
<ul>
<li>驱动变量与干预之间的关系图，在这一步可以确定是应该采取Sharp还是Fuzzy断点回归设计</li>
<li>非结局变量与驱动变量的关系图，可以用来判断是否满足第3条内部有效性(Internal Validity)条件</li>
<li>驱动变量的密度分布图，是为了判断驱动变量是否连续，以及在cut-point附近是否存在被操控，可以用来判读石佛满足第1条内部有效性(Internal Validity)条件</li>
<li>结局变量与驱动变量的关系图，可以帮助预估干预效应的大小，以及判断结局变量与驱动变量之间的函数关系。而且必须是结局变量在纵轴，驱动变量在横轴。<strong>注意：通常这一幅图是用来初步判断整个研究是否能够获得预期的干预效应的，如果在这幅图中无法观测到明显的jump，基本后续的分析也是徒劳。</strong></li>
</ul>
</section>
<section id="进行rd分析的步骤及示例" class="level3" data-number="5.3.6">
<h3 data-number="5.3.6" class="anchored" data-anchor-id="进行rd分析的步骤及示例"><span class="header-section-number">5.3.6</span> 进行RD分析的步骤及示例</h3>
<p><strong>示列软件</strong>: R version 4.0.5 (2021-03-31)<br>
<strong>示列分析包</strong>：在R语言中一共有三个package可以进行RD分析：</p>
<ul>
<li><strong>rdd</strong>: 由Dimmery在2016年发布，最后一次更新是2016-3-14，貌似目前没有获得积极的更新</li>
<li><strong>rddtools</strong>：由Stigler &amp; Quast最早在2013年发布，最后一次更新是2015-07-27，貌似目前也没有获得积极的更新</li>
<li><strong>rdrobust</strong>：由Sebastian Calonico, Matias D. Cattaneo, Max H. Farrell等在2016年发布的，最后一次更新是2018-09-26，是目前功能最完善的RD分析包，同时也开发了Stata版本。该包的作者同时也是RD方法学上的大佬，多种bandwidth选择方法的发明者，著名的CCT就是。</li>
</ul>
<blockquote class="blockquote">
<p>rdrobust简介：目前该包的开发项目可在<a href="https://sites.google.com/site/rdpackages/home" class="uri">https://sites.google.com/site/rdpackages/home</a>主页上查看，该包共有三个函数： + rdplot：用来画图 + rdrobust：用来进行局部非参数估计 + rdbwselect：用来进行bandwidth选择 另外还有一个协同的包<strong>rddensity</strong>，需要从CRAN上单独安装，用来进行对驱动变量是否被操控进行检验，因为rdrobust包未包含McCrary检验</p>
</blockquote>
<p><strong>示列数据集</strong>：采用rdrobust包中自带的<em>rdrobust_RDsenate</em>数据集：</p>
<ul>
<li>数据集简介：该数据集包含了1914–2010年间美国参议院选举的数据，可以利用RD的方法分析民主党赢得参议院席位对于在下次选举中获得的相同席位的影响。该数据共包含两个变量：<br>
&gt; + vote：记录了州级层面下的参议院议席中民主党所占的比例，值从0到100，是RD分析中结局变量 &gt; + margin：记录了民主党在上次选举中获得相同参议院席位的胜利边际，值从-100到100，当大于0时，说明民主党胜利，小于0则输了，是RD分析中的驱动变量</li>
</ul>
<section id="step-1-确定驱动变量rating-variable和断点cut-point" class="level4" data-number="5.3.6.1">
<h4 data-number="5.3.6.1" class="anchored" data-anchor-id="step-1-确定驱动变量rating-variable和断点cut-point"><span class="header-section-number">5.3.6.1</span> Step 1: 确定驱动变量(Rating variable)和断点(Cut-point)</h4>
<p>根据研究设计，判断是否存在采用RD进行因果识别或者效应估计的可能，即是否可以找到合适的驱动变量和明确的断点来识别施加干预的状态。</p>
<p>通常情况下时间（具体到天）、年龄（如研究退休，代表性的文章: <a href="http://cpfd.cnki.com.cn/Article/CPFDTOTAL-BDGF201007002017.htm">“退休影响会健康吗”</a>）、地理距离（研究雾霾，代表性文章: <a href="http://www.cnki.com.cn/Article/CJFDTOTAL-NKJJ201704002.htm">“冬季供暖导致雾霾？来自华北 城市面板的证据”</a>）比较容易作为驱动变量。</p>
</section>
<section id="step-2-内部有效性internal-validity条件的检验" class="level4" data-number="5.3.6.2">
<h4 data-number="5.3.6.2" class="anchored" data-anchor-id="step-2-内部有效性internal-validity条件的检验"><span class="header-section-number">5.3.6.2</span> Step 2: 内部有效性(Internal Validity)条件的检验</h4>
<p><strong>1) 条件一：通过画驱动变量的频率分布直方图或者密度分布图，以及McCrary检验</strong></p>
<p>可以利用graphics包或者ggplot2包画histogram图，也可以利用<strong>rddenstiy</strong>包中的<em>rddenstiy</em>函数画密度图，也可利用<strong>rdd</strong>包进行McCrary检验。</p>
<p><em>rddenstiy</em>函数的其他参数可以用默认值，输出结果中，最下面一行robust的p值大于0.05，就说明驱动变量未受到操纵。</p>
<ul>
<li>方法一</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdrobust)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rddensity)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rdrobust_RDsenate)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="at">x =</span> rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="dv">30</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">'red'</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">'margin'</span>, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">'Frequance'</span>, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">'Histogram of Rating Variable'</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rd1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.1: Histogram of Rating Variable (1)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>方法二</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rdrobust_RDsenate) <span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> margin, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fill =</span> margin <span class="sc">&lt;</span> <span class="dv">0</span>), </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> <span class="st">'black'</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">binwidth =</span> <span class="dv">4</span>, <span class="at">boundary =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Histogram of the Rating varibale'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">'Number of Observation'</span>, </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">'Margin'</span>) <span class="sc">+</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">''</span>, </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">'red'</span>, <span class="st">'blue'</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">'Control'</span>, <span class="st">'Treat'</span>)) <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">9</span>, .<span class="dv">9</span>),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.background =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rd2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.2: Histogram of Rating Variable (2)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li>方法三</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdplotdensity</span>(<span class="fu">rddensity</span>(rdrobust_RDsenate<span class="sc">$</span>margin),</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">X =</span> rdrobust_RDsenate<span class="sc">$</span>margin)<span class="sc">$</span>Estplot[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$data
list()
attr(,"class")
[1] "waiver"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-rd3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd3-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.3: Histogram of Rating Variable (3)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>2) 条件二三四根据研究设计及背景资料进行判断。</strong></p>
</section>
<section id="step-3-画驱动变量与干预的关系图判断sharp或者fuzzy类型" class="level4" data-number="5.3.6.3">
<h4 data-number="5.3.6.3" class="anchored" data-anchor-id="step-3-画驱动变量与干预的关系图判断sharp或者fuzzy类型"><span class="header-section-number">5.3.6.3</span> Step 3: 画驱动变量与干预的关系图，判断sharp或者fuzzy类型</h4>
<p>  画驱动变量与干预的散点图，判断是否为sharp或者fuzzy类型。可以看出本例中，干预在cut-point前后，有明确的界限，为sharp类型。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rdrobust_RDsenate<span class="sc">$</span>treatment <span class="ot">&lt;-</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(rdrobust_RDsenate<span class="sc">$</span>margin <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>rdrobust_RDsenate<span class="sc">$</span>color <span class="ot">&lt;-</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(rdrobust_RDsenate<span class="sc">$</span>margin <span class="sc">&lt;</span> <span class="dv">0</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'blue'</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'red'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> rdrobust_RDsenate<span class="sc">$</span>treatment, </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> rdrobust_RDsenate<span class="sc">$</span>color,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">'p'</span>, </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">'Margin'</span>, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">'Treatment'</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">'Relationship between </span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="st">             rating variable and treatment'</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rd4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd4-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.4: Relationship between rating variable and treatment</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-4-画驱动变量与结果变量的关系图选择合适的bin数量" class="level4" data-number="5.3.6.4">
<h4 data-number="5.3.6.4" class="anchored" data-anchor-id="step-4-画驱动变量与结果变量的关系图选择合适的bin数量"><span class="header-section-number">5.3.6.4</span> Step 4: 画驱动变量与结果变量的关系图，选择合适的bin数量</h4>
<p><strong>一、画散点图</strong></p>
<p>  横轴为驱动变量，纵轴为结果变量，画散点图，初步判断两者之间关系，但是散点图噪音(noise)太大，不利于发现跳跃点，需要对驱动变量分不同的段(intervals or bin)将使得关系取线更平顺。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 第一步：散点图</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">'p'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> rdrobust_RDsenate<span class="sc">$</span>color, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.8</span>, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">'Margin'</span>, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">'Vote'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rd5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd5-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.5: 散点图</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>二、将驱动变量分段的步骤</strong></p>
<p>  将驱动变量分段后再做关系图，大致有四步：</p>
<ul>
<li>将驱动变量分成若干宽度(width)相等的区间(bin)，但是需要注意的是不能存在骑跨cut-point的区间， 所以最好从cut-point开始分别向左右两端进行划分，并不一定要求左右两边的bin数量相等。<br>
</li>
<li>计算每个bin中的结局变量的平均值、驱动变量的中位数，以及个体的数量(num of observation)</li>
<li>将驱动变量的中位数作为横轴，将结局变量的平均值作为纵轴，同时用每个bin中个体的数量进行加权</li>
<li>为了更好的显示两变量之间的关系，最好加上局部加权平滑回归取线(如：lowess: locally weighted regression)</li>
</ul>
<p><strong>三、确定bins数量的方法</strong></p>
<p>  如何设定bin的数量或者binwidth的方法比较复杂，bin的数量不宜过多或过少，过少起不到将噪音的作用，过多会导致jump不明显，在Stata和R中有打包的好的方法去判断bin的数量，本例中采用<strong>rdrobust</strong>包中的<em>rdplot</em>函数进行判断。</p>
<p><strong><em>rdplot</em>函数的常用参数有</strong>：</p>
<ul>
<li>c为cut-point，默认为0</li>
<li>p为全局多项式的幂次方，默认为4</li>
<li>nbins用来设定断点左右的bin的数量，默认为NULL</li>
<li>kernel用来设定加权方法，默认为uniform，同时还有triangular和epanechnikov方法</li>
<li>binselect为判断方法，默认为’esmv’，</li>
</ul>
<p>判断方法常用一共4种：Evenly-spaced (es)，Quantile-spaced (qs)，以及结合mimicking-variance (MV)的esmv和qsmv，推荐使用qs方法。<strong>p和nbin如果不确定也可缺失，让binselect方法自行设定</strong>，从结果可以看出总的样本量，以及cut-point左右的样本量，以及设定的bin的数量。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bins <span class="ot">&lt;-</span> <span class="fu">rdplot</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>               rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">4</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">nbins =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>), </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">binselect =</span> <span class="st">'esmv'</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">kernel =</span> <span class="st">'uniform'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: rdplot

Number of Obs.                 1297
Kernel                      Uniform

Number of Obs.                  595             702
Eff. Number of Obs.             595             702
Order poly. fit (p)               4               4
BW poly. fit (h)            100.000         100.000
Number of bins scale              1               1

Bins Selected                    20              20
Average Bin Length            5.000           5.000
Median Bin Length             5.000           5.000

IMSE-optimal bins                 8               9
Mimicking Variance bins          15              35

Relative to IMSE-optimal:
Implied scale                 2.500           2.222
WIMSE variance weight         0.060           0.084
WIMSE bias weight             0.940           0.916</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-rd6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="chapter_5_files/figure-html/fig-rd6-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">图&nbsp;5.6: 确定bins数量的方法</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-5-模型估计效应大小" class="level4" data-number="5.3.6.5">
<h4 data-number="5.3.6.5" class="anchored" data-anchor-id="step-5-模型估计效应大小"><span class="header-section-number">5.3.6.5</span> Step 5: 模型估计效应大小</h4>
<p><strong>1) 效应大小的估计方法一共有两种：</strong></p>
<ul>
<li>全局参数估计(Parametric/global strategy): 即是利用全部个体的数据，对驱动变量和结局变量拟合线性、二次项、三次项、四次项回归模型，此方法利用的是RD设计的”断点处不连续(discontinuity at a cut-point)“的特性。模型设定如下：</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
Y_i = &amp; \alpha + \beta_0 \cdot Treatment_i + \beta_1 \cdot (rating_i - cutpoint)^k + \\
      &amp; \beta_3 \cdot Treatment_i \cdot (rating_i - cutpoint)^k + \\
      &amp; \beta_4 \cdot Confouders_i + \epsilon_i
\end{aligned}
\]</span></p>
<ul>
<li><strong>式中</strong>：
<ol type="1">
<li>Y为结局变量，<span class="math inline">\(\alpha\)</span> 为常数项，表示在控制驱动变量后干预组结局变量的平均值，k为多项式的幂次，通常为1到4次方，其他参数含义见字面意思，</li>
<li><span class="math inline">\(\beta_0\)</span>就是核心关注的系数，表示干预措施在断点处的边际效应，也就是干预的处理效应。<br>
</li>
<li>而如何选择合适的次项数，需要多次尝试，通过比较AIC，选择AIC最小的模型。</li>
<li>驱动变量减去cutpoint的目的是为了中心化，为了使<span class="math inline">\(\alpha\)</span>反映的是断点处的平均值，因为差值在断点处为0</li>
<li>Confouders为混杂因素，也可以加入模型中，但是中RD分析时，混杂因素的控制不是必须的。</li>
</ol></li>
<li>局部非参数估计(Nonparametric/local strategy): 即是在cut-point左右选择一段合适的带宽(bandwidth)，在这一段带宽局部范围内， 拟合驱动变量和结局变量的线性或者多项式回归模型，此方法利用的是RD设计的”局部随机(local randomization)“的特性。此方法适用于样本量较大的情况， 因为样本量太少，设定带宽之后样本量将会不足，增加估计误差。前面所提到的R包中均只提供局部非参数估计函数。<strong>局部非参数估计的难点在于如何确定最优带宽，常用的方法有交叉验证法(cross validation procedure， CV)、 IK 法和 CCT 法，后两种方法较为推荐</strong></li>
</ul>
<p>  <strong>关于上述两种方法的比较或者权衡，主要是关于精度和误差，全局参数估计因为利用了全部样本，通常对效应的估计精度更高</strong>，然而其也存在一个问题，就是驱动变量和结局变量的关系函数在越大的区间下越难以准确识别；而非参数估计可以通过局部拟合加权线性或者多项式回归模型而减少这种偏误。</p>
<p>  <strong>以上方法主要针对sharp类型，fuzzy类型的估计方法见最后一节。</strong></p>
<p><strong>2) 全局参数估计</strong></p>
<p>  分为一次线性、一次线性加交互项、以及二次、三次线性及交互项，共6个模型，比较AIC或者回归残差，较小者模型较优。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rdrobust_RDsenate<span class="sc">$</span>margin_del <span class="ot">&lt;-</span> rdrobust_RDsenate<span class="sc">$</span>margin <span class="sc">-</span> <span class="dv">0</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># linear</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>fit_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin_del <span class="sc">+</span> treatment, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># linear interaction</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>fit_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin_del <span class="sc">*</span> treatment, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratic</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>fit_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin_del <span class="sc">+</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> treatment, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratic interaction</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>fit_4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> (margin_del <span class="sc">+</span> <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">*</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                   treatment, </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># cubic</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>fit_5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> margin_del <span class="sc">+</span> <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">3</span>) <span class="sc">+</span> treatment, </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># cubic interaction</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>fit_6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vote <span class="sc">~</span> (margin_del <span class="sc">+</span> <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">I</span>(margin_del <span class="sc">^</span> <span class="dv">3</span>)) <span class="sc">*</span> treatment, </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> rdrobust_RDsenate) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Linear"</span> <span class="ot">=</span> fit_1, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Linear interaction"</span> <span class="ot">=</span> fit_2, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Quadratic"</span> <span class="ot">=</span> fit_3), </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">stars =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-rd1" class="anchored">

<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"><caption>表&nbsp;5.1:  全局参数估计 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Linear </th>
   <th style="text-align:center;"> Linear interaction </th>
   <th style="text-align:center;"> Quadratic </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 47.331*** </td>
   <td style="text-align:center;"> 44.904*** </td>
   <td style="text-align:center;"> 45.486*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.542) </td>
   <td style="text-align:center;"> (0.699) </td>
   <td style="text-align:center;"> (0.616) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> margin_del </td>
   <td style="text-align:center;"> 0.348*** </td>
   <td style="text-align:center;"> 0.216*** </td>
   <td style="text-align:center;"> 0.285*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.013) </td>
   <td style="text-align:center;"> (0.028) </td>
   <td style="text-align:center;"> (0.017) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatment </td>
   <td style="text-align:center;"> 4.785*** </td>
   <td style="text-align:center;"> 6.044*** </td>
   <td style="text-align:center;"> 6.663*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.923) </td>
   <td style="text-align:center;"> (0.942) </td>
   <td style="text-align:center;"> (0.963) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> margin_del × treatment </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.170*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.032) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> I(margin_del^2) </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.001*** </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.0002) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 1297 </td>
   <td style="text-align:center;"> 1297 </td>
   <td style="text-align:center;"> 1297 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.578 </td>
   <td style="text-align:center;"> 0.587 </td>
   <td style="text-align:center;"> 0.590 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.577 </td>
   <td style="text-align:center;"> 0.586 </td>
   <td style="text-align:center;"> 0.589 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 10083.7 </td>
   <td style="text-align:center;"> 10056.7 </td>
   <td style="text-align:center;"> 10049.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 10104.4 </td>
   <td style="text-align:center;"> 10082.5 </td>
   <td style="text-align:center;"> 10075.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −5037.848 </td>
   <td style="text-align:center;"> −5023.354 </td>
   <td style="text-align:center;"> −5019.946 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 886.433 </td>
   <td style="text-align:center;"> 613.586 </td>
   <td style="text-align:center;"> 619.091 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 11.77 </td>
   <td style="text-align:center;"> 11.64 </td>
   <td style="text-align:center;"> 11.61 </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
</table>

</div>
</div>
</div>
<p><strong>3) 局部非参数估计</strong></p>
<p>  利用<strong>rdrobust</strong>包的<em>rdrobust</em>函数进行拟合。由于该包是由Sebastian Calonico, Matias D. Cattaneo and Rocío Titiunik开发，所以该包中所提供的带宽选择方法可认为就是CCT法，因为CCT本来就是Calonico, Cattaneo, and Titiunik三人姓氏的缩写。</p>
<p><strong>有两种确定带宽的方法</strong>：</p>
<ul>
<li>一是先利用<em>rdbwselect</em>函数计算出最优带宽，然后用<em>rdrobust</em>函数中的h参数手动指定左右的带宽。<br>
</li>
<li>二是直接利用<em>rdrobust</em>函数中的bdselect参数指定选择最优带宽的方法。</li>
</ul>
<p><strong>rdrobust</strong>包中一共提供了10种选择最优带宽的方法，如下:</p>
<ul>
<li><p>其中，共包含MSE = Mean Square Error和CER = Coverage Error Rate两大类，MSE更适用于进行点估计的带宽选择， 而CER更适合区间估计的带宽选择。</p></li>
<li><p>以rd结尾是表示选择的带宽在cut-point左右相等，而以two结尾是表示选择的带宽在cut-point左右不相等。</p></li>
<li><p>h即为选择的左右最优带宽，而b给出的是用来进行敏感性分析时应该考虑的带宽。</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdbwselect</span>(<span class="at">y =</span> rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: rdbwselect

Number of Obs.                 1297
BW type                         All
Kernel                   Triangular
VCE method                       NN

Number of Obs.                  595          702
Order est. (p)                    1            1
Order bias  (q)                   2            2
Unique Obs.                     595          665

=======================================================
                  BW est. (h)    BW bias (b)
            Left of c Right of c  Left of c Right of c
=======================================================
     mserd    17.754     17.754     28.028     28.028
    msetwo    16.170     18.126     27.104     29.344
    msesum    18.365     18.365     31.319     31.319
  msecomb1    17.754     17.754     28.028     28.028
  msecomb2    17.754     18.126     28.028     29.344
     cerrd    12.407     12.407     28.028     28.028
    certwo    11.299     12.667     27.104     29.344
    cersum    12.834     12.834     31.319     31.319
  cercomb1    12.407     12.407     28.028     28.028
  cercomb2    12.407     12.667     28.028     29.344
=======================================================</code></pre>
</div>
</div>
<p>  虽然在此文中<a href="https://journal.r-project.org/archive/2015/RJ-2015-004/RJ-2015-004.pdf">rdrobust: An R Package for Robust Nonparametric Inference in Regression-Discontinuity Designs</a>提到也可以通过bdselect = ’CV’或者bdselect = ’IK’来采用CV和IK法，但是在写这篇笔记时，已无法使用这两种方法。</p>
<p>输出的结果的最后一张表的第一行Conventional即为干预的处理效应。</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果有混杂因素需要控制,可以用covs = c('var1', 'var2')</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>loc_fit_1 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># c用来指定cut-point，p用来指定局部加权回归的多项式幂次</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>loc_fit_2 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">2</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>loc_fit_3 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'cerrd'</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>loc_fit_4 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin, </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">2</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'certwo'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(loc_fit_1, loc_fit_2,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                  loc_fit_3, loc_fit_4),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> <span class="st">"std.error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-rd2" class="anchored">

<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"><caption>表&nbsp;5.2:  局部非参数估计 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
   <th style="text-align:center;"> Model 3 </th>
   <th style="text-align:center;"> Model 4 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Conventional </td>
   <td style="text-align:center;"> 1.497*** </td>
   <td style="text-align:center;"> 1.852*** </td>
   <td style="text-align:center;"> 1.680*** </td>
   <td style="text-align:center;"> 2.209*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.497) </td>
   <td style="text-align:center;"> (1.852) </td>
   <td style="text-align:center;"> (1.680) </td>
   <td style="text-align:center;"> (2.209) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bias-Corrected </td>
   <td style="text-align:center;"> 1.497*** </td>
   <td style="text-align:center;"> 1.852*** </td>
   <td style="text-align:center;"> 1.680*** </td>
   <td style="text-align:center;"> 2.209*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.497) </td>
   <td style="text-align:center;"> (1.852) </td>
   <td style="text-align:center;"> (1.680) </td>
   <td style="text-align:center;"> (2.209) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Robust </td>
   <td style="text-align:center;"> 1.759*** </td>
   <td style="text-align:center;"> 2.056*** </td>
   <td style="text-align:center;"> 1.841*** </td>
   <td style="text-align:center;"> 2.282*** </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.759) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (2.056) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.841) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (2.282) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Kernel </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bandwidth </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> cerrd </td>
   <td style="text-align:center;"> certwo </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
</table>

</div>
</div>
</div>
</section>
<section id="step-6-敏感性分析" class="level4" data-number="5.3.6.6">
<h4 data-number="5.3.6.6" class="anchored" data-anchor-id="step-6-敏感性分析"><span class="header-section-number">5.3.6.6</span> Step 6: 敏感性分析</h4>
<p>  敏感性分析主要用来检验模型估计结果的稳健性，RD分析主要有四种敏感性分析方式;</p>
<ol type="1">
<li><p>对前面所述的Internal Validity条件三的检验，即除了干预(Treatment)变量外，其他的任何非结局变量(包括混杂因素在内)都不能在cut-point处出现不连续或称为跳跃，如果存在，则无法推断结局变量的跳跃是由干预(Treatment)引起的，检验方式就是将所有的混杂因素作为结局，利用<em>rdrobust</em>函数进行检验，输出结果的coef应该很小，且p值应该统计学不显著 (Continuity-Based Analysis for Covariates)。</p></li>
<li><p>对cut-point的敏感性分析，即是更换cut-point，检验是否左右还存在处理效应，如果更换断点后，仍然存在处理效应，则无法说明本研究的干预措施是有效的，因为在研究设定的断点处识别到的处理效应，有可能是由其他因素引起的。</p></li>
<li><p>对cut-point附近个体的敏感性分析，在Internal Validity条件一中提到，驱动变量不可被操控，但是这个无法直接检验，因此，换个思路，如果驱动变量被超控，那自然是在cut-point左右离得最近的值被操纵的可能性最大，所以如果将这部分个体剔除，若仍然能观测到处理效应，则说明这种效应是真实由干预所导致。这种方法被称为甜甜圈(donut hole)法，同样也适用于个体过多的堆积与cut-point附近的RD分析。</p></li>
<li><p>对带宽bandwidth的敏感性分析，即是cut-point不改变，而是更换选择的最优带宽，进行多次局部非参数检验，如果更换带宽之后，仍然能在断点处识别的处理效应，说明研究的干预措施是有效的，因为在研究设定的断点处识别到的处理效应不是由于某一特点的带宽下才观测到的，说明处理效应稳健。</p></li>
</ol>
<p><strong>1) 对cut-point的敏感性分析</strong></p>
<p>  选择一个虚拟的断点用来替换真正的断点，但是真实的干预情况不改变。关于虚拟断点如何选择以及选择多少个并没有明确的标准，通常在真实断点的附近，左右对称选取即可</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sen_cut_1 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>sen_cut_2 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RDsenate<span class="sc">$</span>vote, </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                      rdrobust_RDsenate<span class="sc">$</span>margin,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">c =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(sen_cut_1, sen_cut_2), </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> <span class="st">"std.error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-rd3" class="anchored">

<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"><caption>表&nbsp;5.3:  对cut-point的敏感性分析 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Conventional </td>
   <td style="text-align:center;"> 1.406*** </td>
   <td style="text-align:center;"> 1.614 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.406) </td>
   <td style="text-align:center;"> (1.614) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bias-Corrected </td>
   <td style="text-align:center;"> 1.406*** </td>
   <td style="text-align:center;"> 1.614 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.406) </td>
   <td style="text-align:center;"> (1.614) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Robust </td>
   <td style="text-align:center;"> 1.640** </td>
   <td style="text-align:center;"> 1.865 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.640) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.865) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Kernel </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bandwidth </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> msetwo </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
</table>

</div>
</div>
</div>
<p><strong>2) 对cut-point附近个体的敏感性分析</strong></p>
<p>  对称剔除真实断点左右一定较小范围内的个体。关于范围的大小同样没有明确的标准，通常选取多个范围比较即可。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rdrobust_RD_hole_1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(rdrobust_RDsenate, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">abs</span>(margin) <span class="sc">&gt;</span> <span class="fl">0.3</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>rdrobust_RD_hole_2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(rdrobust_RDsenate, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">abs</span>(margin) <span class="sc">&gt;</span> <span class="fl">0.4</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>rdrobust_RD_hole_3 <span class="ot">&lt;-</span> <span class="fu">subset</span>(rdrobust_RDsenate, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">abs</span>(margin) <span class="sc">&gt;</span> <span class="fl">0.5</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>sen_hole_1 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RD_hole_1<span class="sc">$</span>vote, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                       rdrobust_RD_hole_1<span class="sc">$</span>margin, </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>sen_hole_2 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RD_hole_2<span class="sc">$</span>vote, </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                       rdrobust_RD_hole_2<span class="sc">$</span>margin, </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 除c以外的其他参数应该与前面分析保持一致</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>sen_hole_3 <span class="ot">&lt;-</span> <span class="fu">rdrobust</span>(rdrobust_RD_hole_3<span class="sc">$</span>vote, </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                       rdrobust_RD_hole_3<span class="sc">$</span>margin, </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">c =</span> <span class="dv">0</span>, <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">kernel =</span> <span class="st">'triangular'</span>, </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bwselect =</span> <span class="st">'msetwo'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(sen_hole_1, sen_hole_2, sen_hole_3), </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"kableExtra"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> <span class="st">"std.error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-rd4" class="anchored">

<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"><caption>表&nbsp;5.4:  对cut-point附近个体的敏感性分析 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
   <th style="text-align:center;"> Model 2 </th>
   <th style="text-align:center;"> Model 3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Conventional </td>
   <td style="text-align:center;"> 1.558*** </td>
   <td style="text-align:center;"> 1.558*** </td>
   <td style="text-align:center;"> 1.591*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.558) </td>
   <td style="text-align:center;"> (1.558) </td>
   <td style="text-align:center;"> (1.591) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bias-Corrected </td>
   <td style="text-align:center;"> 1.558*** </td>
   <td style="text-align:center;"> 1.558*** </td>
   <td style="text-align:center;"> 1.591*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (1.558) </td>
   <td style="text-align:center;"> (1.558) </td>
   <td style="text-align:center;"> (1.591) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Robust </td>
   <td style="text-align:center;"> 1.839*** </td>
   <td style="text-align:center;"> 1.860*** </td>
   <td style="text-align:center;"> 1.918*** </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.839) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.860) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (1.918) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Kernel </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
   <td style="text-align:center;"> Triangular </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Bandwidth </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> msetwo </td>
   <td style="text-align:center;"> msetwo </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
</table>

</div>
</div>
</div>
<p><strong>3) 对带宽bandwidth的敏感性分析</strong></p>
<p>  即是更换不同的带宽即可，带宽的变化实际是cut-point区间范围尾部的个体在发生变化，可以通过选取不同的带宽选择方式，真实存在的处理效应不会随着带宽的改变而发生变化。</p>
</section>
</section>
<section id="关于fuzzy类型的rd模型估计方法" class="level3" data-number="5.3.7">
<h3 data-number="5.3.7" class="anchored" data-anchor-id="关于fuzzy类型的rd模型估计方法"><span class="header-section-number">5.3.7</span> 关于Fuzzy类型的RD模型估计方法</h3>
<p>  Fuzzy类型的RD可以根据驱动变量与干预的实际情况采取不同的处理方式:</p>
<ul>
<li><p>如果只是no-shows的情况，可以结合研究目的，决定是否采取意向性分析法(intent-to-treat)</p></li>
<li><p>采用两阶段回归two-stage least squares (2SLS) ，两阶段模型设定如下:</p>
<ul>
<li><p>第一阶段：<br>
<span class="math display">\[ Treatment_i = \alpha_1 + \gamma_0 \cdot treat-by-cutpoint_i + \epsilon_i \]</span></p></li>
<li><p>第二阶段：<br>
<span class="math display">\[ Y_i = \alpha_i + \beta_0 \cdot \dot Treatment + \mu_i \]</span></p>
<ul>
<li>其中：
<ol type="1">
<li><span class="math inline">\(Treatment_i\)</span>为真实的干预情况</li>
<li><span class="math inline">\(treat-by-cutpoint_i\)</span>是指驱动变量根据cut-point判断的是否接受了干预，为虚拟变量</li>
<li>第二阶段模型中的<span class="math inline">\(\dot Treatment\)</span>将第一阶段模型的预测指yhat</li>
</ol></li>
</ul></li>
</ul></li>
</ul>
<p>通过两阶段回归，第二阶段中的Standard errors是经过了调整的。<strong>在<em>rdrobust</em>包的rdrobust函数中，有一个<code>fuzzy</code>的逻辑参数，用来指定RD类型是否为fuzzy，可以很方便的进行fuzzy类型的模型估计。</strong></p>
</section>
<section id="结束" class="level3" data-number="5.3.8">
<h3 data-number="5.3.8" class="anchored" data-anchor-id="结束"><span class="header-section-number">5.3.8</span> 结束</h3>
<p>  由于真实世界的复杂性，对因果推断的分析方法的要求也越来越高，没有一种方法可以适用所有的情形，因此RD的方法也衍生发展出很多类型，包括多个断点(Multi-Cutoff RD Design)、多个驱动变量(Multi-Score RD Design)、离散驱动变量(Multi-Score RD Design)等等。</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-Sebastian2022" class="csl-entry" role="doc-biblioentry">
Calonico, Sebastian, Matias D. Cattaneo, Max H. Farrell, and Rocio Titiunik. 2022. <em>Rdrobust: Robust Data-Driven Statistical Inference in Regression-Discontinuity Designs</em>. <a href="https://CRAN.R-project.org/package=rdrobust">https://CRAN.R-project.org/package=rdrobust</a>.
</div>
<div id="ref-matias2017" class="csl-entry" role="doc-biblioentry">
D. Cattaneo, Matias, Nicolas Idroboy, and Roc Titiunik. 2017. <em>A Practical Introduction to Regression Discontinuity Designs: Volume i</em>. collingwoodresearch.com.
</div>
<div id="ref-jacob2012" class="csl-entry" role="doc-biblioentry">
Jacob, Robin, Pei Zhu, and Marie-Andrée. 2012. <em>A Practical Guide to Regression Discontinuity</em>. MDRC.org.
</div>
<div id="ref-xie2019" class="csl-entry" role="doc-biblioentry">
谢谦, 薛仙玲, and 付明卫. 2019. <span>“断点回归设计方法应用的研究综述.”</span> <em>经济与管理评论</em> 35 (2): 11.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter_4.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">数据的描述</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter_6.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">番外篇（一）：随机化分组</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2022 Chi Shen, Xi'an Jiaotong University
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>